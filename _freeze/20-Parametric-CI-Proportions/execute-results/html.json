{
  "hash": "5a635ea6b09dd4b4e1c176205deed9e7",
  "result": {
    "markdown": "---\ntitle: '5.5: Parametric Confidence Intervals for Proportions'\n#author: 'Adam Spiegler, University of Colorado Denver'\nexecute:\n  eval: false\noutput:\n  html_document:\n#    toc: yes\n#    toc_depth: 1\n#    theme: cerulean\n#jupyter:\n#  kernelspec:\n#    display_name: R\n#    language: R\n#    name: ir\n#output:\n#    ipynbdocument::ipynb_document\n---\n\n\n\n[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://githubtocolab.com/CU-Denver-MathStats-OER/Statistical-Theory/blob/main/Chap5/20-Parametric-CI-Proportions.ipynb) <nbsp> \n\n\n\n# Public Opinion Polls\n\n---\n\nConfidence intervals are frequently used when polling public opinion. Rather than give a point estimate alone, poll results are typically given along with a  <span style=\"color:dodgerblue\">**margin of error**</span> corresponding to a specified <span style=\"color:dodgerblue\">**confidence level**</span>, which is typically 95%. For example, summarized in the bar plot and table below are the results of a PBS NewsHour/NPR/Marist poll^[\"Politics still drives how Americans fell about COVID response, one year in\", [PBS/News Hour](https://www.pbs.org/newshour/politics/politics-still-drives-how-americans-feel-about-covid-response-one-year-in), March 11, 2021] that surveyed ${\\color{tomato}{n=1,\\!227}}$ randomly selected adults in the US and gauged their opinions on how the US is handling the COVID pandemic approximately one year after the initial outbreak in the United States.\n\n\n![A stacked bar plot summary of poll results.](https://raw.githubusercontent.com/CU-Denver-MathStats-OER/Statistical-Theory/main/Images/20fig-vaccination-poll1.png){width=\"70%\"}\n\n![A table summary of the poll results](https://raw.githubusercontent.com/CU-Denver-MathStats-OER/Statistical-Theory/main/Images/20fig-vaccination-table1.png)\n\n\n## Question 1\n\n---\n\nBased on the poll summaries above, approximately what proportion of ALL adults in the US do NOT plan to get vaccinated?\n\n### Solution to Question 1\n\n---\n\n<br>  \n<br>  \n<br>  \n\n\n\n\n# A General Summary of Confidence Intervals\n\n--- \n\nA confidence interval is an interval estimate for a population parameter with a rate of success given by the confidence level of the interval. We can construct confidence intervals for all sorts of statistics, and we can use confidence intervals as a tool for analyzing possible associations between two different variables. In general, a confidence interval has three components:\n\n- A point estimate is calculated from a sample.\n- A confidence level is chosen.\n- A margin of error (MoE) to account for the uncertainty due to sampling. \n  - The MoE depends on the confidence level that is chosen.\n  - Careful, the MoE is different from the standard error, but they are related!\n  - **The MoE is a multiple of the standard error, SE.**\n\n\nIf we want to construct a confidence interval estimate for parameter $\\theta$, then we have\n\n$$({\\color{dodgerblue}{\\mbox{point estimate}}}) - {\\color{tomato}{\\mbox{MoE}}} < \\theta < ({\\color{dodgerblue}{\\mbox{point estimate}}}) + {\\color{tomato}{\\mbox{MoE}}}.$$ \n\nAll confidence intervals have this same general structure that we can construct using similar steps:\n\n\n1. <span style=\"color:dodgerblue\">Choose a point estimate.</span>\n2. Using the CLT, estimate the standard error.\n3. Based on the confidence level, find the appropriate multiple ($z_{\\alpha/2}$ or $t_{\\alpha/2}$).\n4. <span style=\"color:tomato\">The margin of error (MoE) is the of product the SE and either $z_{\\alpha/2}$ or $t_{\\alpha/2}$.</span>\n\n\n#### Confidence Intervals for a Single Mean with Known $\\sigma^2$\n\n---\n\nIf we would like to estimate a population mean $\\mu$ of a population that has known variance $\\sigma^2$, we can pick a random sample of $n$ values from the population. As long as the [sample is large enough](#sec-samp-size) or symmetric, we have:\n\n1. <span style=\"color:dodgerblue\">A reasonable point estimate is the corresponding sample mean, $\\bar{x}$.</span>\n2. From CLT, the standard error is $\\mbox{SE} = \\frac{\\sigma}{\\sqrt{n}}$.\n3. Using the standard normal distribution, find the value of $z_{\\alpha/2}$.\n4. <span style=\"color:tomato\">The MoE $= z_{\\alpha/2} \\cdot \\frac{\\sigma}{\\sqrt{n}}$.</span>\n\n\n$$ {\\color{dodgerblue}{\\overline{X}}} - {\\color{tomato}{z_{\\alpha/2} \\cdot \\frac{\\sigma}{\\sqrt{n}}}} < \\mu < {\\color{dodgerblue}{\\overline{X}}} + {\\color{tomato}{z_{\\alpha/2} \\cdot \\frac{\\sigma}{\\sqrt{n}}}} .$$ \n\n\n#### Confidence Intervals for a Single Mean with Unknown $\\sigma^2$\n\n---\n\nIf we would like to estimate a population mean $\\mu$ of a population that has unknown variance $\\sigma^2$, we can pick a random sample of $n$ values from the population. As long as the [sample is large enough](#sec-samp-size) or symmetric, we have:\n\n1. <span style=\"color:dodgerblue\">A reasonable point estimate is the corresponding sample mean, $\\bar{x}$.</span>\n2. We use CLT, <span style=\"color:mediumseagreen\">plugging $s$ in place of $\\sigma$</span>, to get  $\\mbox{SE} = \\frac{{\\color{mediumseagreen}{s}}}{\\sqrt{n}}$.\n3. Using a <span style=\"color:mediumseagreen\">$t$-distribution</span>, find the value of ${\\color{mediumseagreen}{t_{\\alpha/2}}}$.\n4. <span style=\"color:tomato\">The MoE $= {\\color{mediumseagreen}{t_{\\alpha/2}}} \\cdot \\frac{{\\color{mediumseagreen}{s}}}{\\sqrt{n}}$.</span>\n\n\n$${\\color{dodgerblue}{\\overline{X}}} - {\\color{tomato}{t_{\\alpha/2} \\cdot \\frac{s}{\\sqrt{n}}}} < \\mu < {\\color{dodgerblue}{\\overline{X}}} + {\\color{tomato}{t_{\\alpha/2} \\cdot \\frac{s}{\\sqrt{n}}}} .$$ \n\n#### Confidence Interval for a Difference in Two Means\n\n---\n\nIf we would like to estimate the difference in means from two independent populations that have unknown variances, we can pick random samples of sizes $n_1$ and $n_2$ from each respective population. As long as the [samples are large enough](#sec-samp-size) or symmetric, we have:\n\n1. <span style=\"color:dodgerblue\">A reasonable point estimate is the corresponding difference in sample means, $\\bar{x}_1 - \\bar{x}_2$.</span>\n2. We use CLT, <span style=\"color:mediumseagreen\">plugging $s_1$ and $s_2$ in place of $\\sigma_1$ and $\\sigma_2$</span>, to get  \n\n$${\\color{mediumseagreen}{\\mbox{SE} = \\sqrt{ \\frac{s_1^2}{n_1} + \\frac{s_2^2}{n_2}}}}.$$\n\n3. Using a <span style=\"color:mediumseagreen\">$t$-distribution</span>, find the value of ${\\color{mediumseagreen}{t_{\\alpha/2}}}$.\n4. <span style=\"color:tomato\">The MoE $= {\\color{mediumseagreen}{t_{\\alpha/2}}} \\cdot \\sqrt{ \\frac{{\\color{mediumseagreen}{s_1}}^2}{n_1} + \\frac{{\\color{mediumseagreen}{s_2}}^2}{n_2}}$.</span>\n\n\n$$\\left( {\\color{dodgerblue}{\\overline{X}-\\overline{Y}}} \\right) - {\\color{tomato}{t_{\\alpha/2} \\cdot \\sqrt{ \\frac{s_1^2}{n_1} + \\frac{s_2^2}{n_2}}}} < \\mu_1 - \\mu_2 < \\left( {\\color{dodgerblue}{\\overline{X}-\\overline{Y}}} \\right) + {\\color{tomato}{t_{\\alpha/2} \\cdot \\sqrt{ \\frac{s_1^2}{n_1} + \\frac{s_2^2}{n_2}}}} .$$ \n\n## Question 2\n\n---\n\nWe would like to estimate the parameter $p$, the proportion of all adults in the US that do not plan on getting vaccinated. From the vaccination poll in [Question 1], we have one random sample of 1,227 adults. From our sample, we observe that 30% said they do not intend to get vaccinated. Let's apply the same general process summarized above to construct a 95% confidence interval to estimate the **proportion** of all adults in the US that do not plan on getting vaccinated.\n\n\n### Question 2a\n\n---\n\nBased on the sample of polled adults, what is a reasonable point estimate for $p$, the proportion of all adults in the US that do not plan on getting vaccinated?\n\n\n#### Solution to Question 2a\n\n---\n\n\n<br>  \n<br>  \n<br>  \n\n\n### Question 2b\n\n---\n\nUsing the [Central Limit Theorem for proportions](11-Sampling-Dist-Prop.qmd#sec-clt-prop), estimate the standard error for the sampling distribution of sample proportions.\n\n::: {.callout-tip}\nTo calculate the standard error, we need to know the population proportion $p$. Plug an appropriate sample statistic in place of $p$ to estimate the standard error.\n:::\n\n#### Solution to Question 2b \n\n---\n\n\n<br>  \n<br>  \n<br>  \n\n\n### Question 2c\n\n---\n\nNext, we identify the value ($z_{\\alpha/2}$ or $t_{\\alpha/2}$) we multiply the standard error by to get the margin of error. For proportions, as long as the [the sample is large enough](#sec-samp-size), a normal distribution is an accurate model for the underlying sampling distribution. \n\nFrom the poll in [Question 1], we have $n=1227$. Since we do not know $p$, we substitute $\\hat{p} = 0.3$ instead. Since both $n\\hat{p} \\geq 10$ and $n(1-\\hat{p}) \\geq 10$, we can **use a normal distribution to calculate the margin of error** for the confidence interval. \n\nWhat is the value of $z_{\\alpha/2}$ for a 95% confidence interval for a proportion?\n\n\n\n#### Solution to Question 2c\n\n---\n\n\n<br>  \n<br>  \n<br>  \n\n\n### Question 2d\n\n---\n\nBased on your previous answers in [Question 2], give a 95% confidence interval to estimate $p$, the proportion of all adults in the US that do not plan on getting vaccinated.\n\n\n\n#### Solution to Question 2d\n\n---\n\n<br>  \n<br>  \n<br>  \n\n### Question 2e\n\n---\n\nInterpret the practical meaning of your confidence interval in [Question 2d] in the context of COVID vaccinations in the US.\n\n#### Solution to Question 2e\n\n---\n\n<br>  \n<br>  \n<br>  \n\n\n\n\n# Wald Confidence Interval for a Proportion\n\n---\n\nThe <span style=\"color:dodgerblue\">**Wald confidence interval for a proportion**</span> is given by\n\n$${\\large \\boxed{ \\mbox{Wald:} \\qquad {\\color{tomato}{\\hat{p}}} - z_{\\alpha/2} \\cdot \\sqrt{ \\frac{{\\color{tomato}{\\hat{p}}}(1-{\\color{tomato}{\\hat{p}}})}{n}}  < p <  {\\color{tomato}{\\hat{p}}} + z_{\\alpha/2} \\cdot \\sqrt{ \\frac{{\\color{tomato}{\\hat{p}}}(1-{\\color{tomato}{\\hat{p}}})}{n}}}}$$\n\nWe use the **plug-in principle** and <span style=\"color:tomato\">use $\\hat{p}$ for the unknown value of $p$</span> when calculating the standard error.\n\n-   The advantage of this estimate is we can do it by hand.\n-   The downside is that when we use $\\hat{p}$ in place of $p$ we lose quite a bit of accuracy.\n\n# Agresti-Coull Confidence Interval for a Proportion\n\n---\n\nWhen constructing a Wald confidence interval for a proportion, we use the sample proportion $\\hat{p}$ as an estimator for $p$. The sample proportion is a very reasonable and intuitive point estimate. In addition, $\\hat{p}$ is an **unbiased** estimator for $p$. However, there are many other estimators that could make sense to use in place of the parameter $p$, and there are other properties of estimators we should take into account. In particular, using a less precise estimator such as $\\hat{p}$ results in a larger margin of error in the confidence interval compared to some other estimators.\n\nWhen studying properties of estimators, we [considered another estimator for the parameter $p$](15-Properties-Estimators.qmd#sec-compare-prop), namely ${\\color{tomato}{\\tilde{p} = \\frac{X+2}{n+4}}}$, where $X$ denotes the number of \"successes\". Comparing estimators $\\hat{p}$ and $\\tilde{p}$, we discovered that:\n\n- The sample proportion $\\hat{p}$ is unbiased but less precise.\n- The modified sample proportion ${\\color{tomato}{\\tilde{p}}}$ is **slightly biased but more precise**.\n- The confidence interval using ${\\color{tomato}{\\tilde{p}}}$ will usually have a **smaller margin of error** than using $\\hat{p}$.\n\n\nThe <span style=\"color:dodgerblue\">**Agresti-Coull confidence interval for a proportion**</span> is\n\n$${\\large \\boxed{ \\mbox{Agresti-Coull:} \\qquad {\\color{tomato}{\\tilde{p}}} - z_{\\alpha/2} \\left( \\sqrt{ \\frac{{\\color{tomato}{\\tilde{p}}}(1-{\\color{tomato}{\\tilde{p}}})}{{\\color{dodgerblue}{n+4}}}} \\right) < p <  {\\color{tomato}{\\tilde{p}}} + z_{\\alpha/2} \\left( \\sqrt{ \\frac{{\\color{tomato}{\\tilde{p}}}(1-{\\color{tomato}{\\tilde{p}}})}{{\\color{dodgerblue}{n+4}}}} \\right)}}.$$\n\n\n## Question 3\n\n---\n\nUsing the same poll from [Question 1], find a 95% confidence interval for the proportion of all adults in the US that do not plan to get vaccinated using the Agresti-Coull confidence interval for a proportion.\n\n### Solution to Question 3\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# use code to help with the calculations\n```\n:::\n\n\n<br>  \n<br>  \n\n\n# Score Confidence Interval For a Proportion\n\n---\n\nFrom the [CLT for proportions](11-Sampling-Dist-Prop.qmd#sec-clt-prop), we have $\\widehat{P} \\sim N \\left( \\mu_{\\widehat{P}} , \\sigma_{\\widehat{P}} \\right) = N\\left( p, \\sqrt{\\frac{ p (1-p)}{n}} \\right)$. A standardized sample proportion has $z$-score $z = \\frac{\\hat{p} - p}{\\sqrt{\\frac{ p (1-p)}{n}}}$. Thus, for confidence level $CL$, we have\n\n$$P \\left( -z_{\\alpha/2} < \\frac{\\hat{p} -\\color{tomato}{p}}{\\sqrt{\\frac{\\color{tomato}{p}(1-\\color{tomato}{p})}{n}}} < z_{\\alpha/2} \\right) =CL.$$\n\nIn the equation above, the <span style=\"color:tomato\">unknown population parameter $p$ is in red</span>. All the other values ($\\hat{p}$, $n$, and $z_{\\alpha/2}$) in the formula are known values. Given a confidence level, we can algebraically solve for the cutoff values for ${\\color{tomato}{p}}$ by solving the equations:\n\n\n$$\\dfrac{\\hat{p} -{\\color{tomato}{p}}}{\\sqrt{\\dfrac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n}}} = z_{\\alpha/2} \\qquad \\mbox{and} \\qquad \\dfrac{\\hat{p} - {\\color{tomato}{p}}}{\\sqrt{\\dfrac{{\\color{tomato}{p}}(1-{\\color{tomato}{p})}}{n}}} = -z_{\\alpha/2}$$\n\n\n## Score Confidence Interval Formulas\n\n---\n\nThe confidence interval estimate resulting from the algebraic solution is called the <span style=\"color:dodgerblue\">**score confidence interval for a proportion**</span>. The algebraic work involved in solving the equations above is provided in the [Appendix](#sec-score). The corresponding lower ($L$) and upper ($U$) cutoffs are:\n\n$$\\begin{aligned}\n&L= \\dfrac{\\hat{p} + \\dfrac{z_{\\alpha/2}^2}{2n} - z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{\\hat{p}(1-\\hat{p})}{n} + \\dfrac{z_{\\alpha/2}^2}{4n^2}}}{1+ \\dfrac{z_{\\alpha/2}^2}{n}} \\\\\n\\\\\n&U= \\dfrac{\\hat{p} + \\dfrac{z_{\\alpha/2}^2}{2n} + z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{\\hat{p}(1-\\hat{p})}{n} + \\dfrac{z_{\\alpha/2}^2}{4n^2}}}{1+ \\dfrac{z_{\\alpha/2}^2}{n}}\n\\end{aligned}$$\n\n- **Pro:** There is no additional uncertainty beyond the initial variability in sampling. \n- **Con:** The formulas are quite complicated. Calculating by hand is not really practical.\n- Typically we use technology to calculate score confidence intervals.\n\n\n## Score Confidence Intervals in R\n\n---\n\nR has a built in function `prop.test()$conf.int` that calculates a score confidence interval for a proportion.\n\n- In R, use the command `prop.test(X, n, conf.level = CL, correct = FALSE)$conf.int`\n  - $X$ denotes the number of \"successes\" observed in the sample.\n  - $n$ denotes the total number of observations in the sample.\n  - `CL` is a chosen confidence level (as a proportion).\n  - The option `correct = FALSE` means no [continuity correction](#sec-score-corr) is applied.\n\n\n## Question 4\n\n---\n\nUsing the poll data in [Question 1], find a 95% score confidence interval for the proportion of all adults in the US that do not plan to get vaccinated by completing the `prop.test()` command in the code cell below.\n\n### Solution to Question 4\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprop.test(??, ??, conf.level = ??, correct = FALSE)$conf.int\n```\n:::\n\n\n<br>  \n<br>  \n\n#### Checking Your Solution to Question 4 \n\n---\n\nBased on the polling sample data, enter the values for `X`, `n`, and `z.star` in the first code cell below. Then run the code cell. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n##################################################\n# Replace the ?? in the three lines of code below\n# with appropriate values or commands\n##################################################\nX <- ??  # number of successes in sample (do not plan to get vax)\nn <- ??  # sample size\nz.star <- ??  # find z_alpha/2 for 95% confidence level\n```\n:::\n\n\n\nNext, run the code cell below to calculate the upper and lower cutoffs for a 95% score confidence interval for a proportion.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#########################################\n# first run the code cell above\n# nothing to edit in this code cell\n# run as is\n#########################################\nphat <- X/n  # Compute sample proportion\n\n# Computes Cutoffs for Score Confidence Interval\nlower.score95 <- (phat+z.star^2/(2*n) - \n                z.star*sqrt( (phat*(1-phat))/n + z.star^2/(4*n^2) ) )/(1+z.star^2/n)\nupper.score95 <- (phat+z.star^2/(2*n) + \n                z.star*sqrt( (phat*(1-phat))/n + z.star^2/(4*n^2) ) )/(1+z.star^2/n)\n\n# Print cutoffs to screen\nlower.score95\nupper.score95\n```\n:::\n\n\n## Applying the Continuity Correction\n \n---\n\nIn our construction of a score confidence interval, we have used a normal distribution to estimate a discrete (binomial) distribution. Recall when using a continuous, normal distribution to approximate a discrete, binomial distribution (as with the Central Limit Theorem for proportions), we miss some area under the curve resulting in an underestimate.  We can improve estimates resulting from using a normal distribution instead of a binomial distribution by\napplying a [continuity correction](11-Sampling-Dist-Prop#sec-cont-corr). \n\nSimilarly, we can obtain more a more accurate score confidence interval for a proportion by applying a continuity correction. The [Appendix explains how the continuity correction is applied](#sec-score-corr) and provides the corresponding formulas. In practice, we can simply change the `correct = FALSE` option in `prop.test()$conf.int` to `correct = TRUE`.\n\n- `prop.test(X, n, conf.level = CL, correct = TRUE)$conf.int`\n- The default for `prop.test` if no `correct` option is specified is `correct = TRUE`.\n- <span style=\"color:dodgerblue\">**Applying the continuity correction results in a more precise confidence interval.**</span>\n\n\n### Applying the Continuity Correction in Code\n\n---\n\nBelow we perform the direct calculations using the [continuity correction formulas derived in the Appendix](#sec-score-corr).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##############################################\n# Be sure you have run previous code cells\n# And have already defined X, n, and z.star\n# Run this code cell without any edits needed\n##############################################\n\n# Continuity corrections applied to sample proportion\ncc.phat.L <- (X - 0.5)/n\ncc.phat.U <- (X + 0.5)/n\n\n# Plugged into formulas for Score Conf Interval\ncc.lower <- (cc.phat.L + z.star^2/(2*n) - \n            z.star*sqrt( (cc.phat.L*(1-cc.phat.L))/n + z.star^2/(4*n^2) ) )/(1+z.star^2/n)\ncc.upper <- (cc.phat.U + z.star^2/(2*n) + \n            z.star*sqrt( (cc.phat.U*(1-cc.phat.U))/n + z.star^2/(4*n^2) ) )/(1+z.star^2/n)\n\n# Print results to screen to check\ncc.lower\ncc.upper\n```\n:::\n\n\nIn the code cell below, we apply the continuity correction using the `correct = TRUE` option in `prop.test()` to compare with the previous result.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprop.test(368, 1227, conf.level = 0.95, correct = TRUE)$conf.int\n```\n:::\n\n\n<br>  \n<br>  \n\n\n# A Difference in Two Proportions\n\n---\n\n## Central Limit Theorem for $\\widehat{P}_1 - \\widehat{P}_2$\n\n--- \n\nFor a difference in two proportions, we can derive a Central Limit Theorem to model the sampling distribution for the difference in two sample proportions, $\\widehat{P}_1 - \\widehat{P}_2$. See the [Appendix for a proof of the CLT for a difference in two proportions](#sec-clt-diffprop) which is stated below:\n\n$$\\widehat{P}_1 - \\widehat{P}_2  \\sim N \\left( \\mu_{\\widehat{P}_1 - \\widehat{P}_2} , \\mbox{SE}(\\widehat{P}_1 - \\widehat{P}_2) \\right) = N \\left( p_1 - p_2  , \\sqrt{\\frac{p_1(1-p_1)}{n_1} + \\frac{p_2(1-p_2)}{n_2}} \\right).$$\n\n\n## Confidence Interval for $\\widehat{P}_1 - \\widehat{P}_2$\n\n---\n\nWe can modify the <span style=\"color:dodgerblue\">**Wald confidence interval**</span> to give an approximation for a confidence interval for a difference in two proportions\n\n-   The <span style=\"color:dodgerblue\">point estimate</span> is the difference in the two sample proportions, $\\color{dodgerblue}{\\hat{p}_1 - \\hat{p}_2}$.\n-   The standard error we estimate by  <span style=\"color:mediumseagreen\">plugging $\\hat{p}_1$ and $\\hat{p}_2$ in place of $p_1$ and $p_2$</span> in the formula for the standard error from the Central Limit Theorem:\n\n$$\\mbox{SE} \\left( \\widehat{P}_1 - \\widehat{P}_2 \\right) = \\sqrt{ \\frac{p_1(1-p_1)}{n_1} + \\frac{p_2(1-p_2)}{n_2}} \\approx \\sqrt{ \\frac{{\\color{mediumseagreen}{\\hat{p}_1}}(1-{\\color{mediumseagreen}{\\hat{p}_1}})}{n_1} + \\frac{{\\color{mediumseagreen}{\\hat{p}_2}}(1-{\\color{mediumseagreen}{\\hat{p}_2}})}{n_2}}$$\n\n- We **use the standard normal distribution** to identify $z_{\\alpha/2}$ to find the <span style=\"color:tomato\">margin of error</span>.\n\n$$({\\color{dodgerblue}{\\hat{p}_1 - \\hat{p}_2}}) - {\\color{tomato}{z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{\\hat{p}_1(1-\\hat{p}_1)}{n_1} + \\dfrac{\\hat{p}_2 (1-\\hat{p}_2) }{n_2}}}}  < p_1-p_2 < ({\\color{dodgerblue}{\\hat{p}_1 - \\hat{p}_2}}) + {\\color{tomato}{z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{\\hat{p}_1(1-\\hat{p}_1)}{n_1} + \\dfrac{\\hat{p}_2 (1-\\hat{p}_2) }{n_2}}}}.$$\n\nWe use Wald confidence intervals for a difference in two proportions, but be aware there are other variations of confidence intervals for a difference in two proportions, similar to the Agresti-Coull and score confidence intervals.  In R, the command \n\n<center>`prop.test(c(x1, x2), c(n1, n2), conf.level = CL, correct = TRUE)$conf.int` </center>\n\n<br> \ncomputes a **Wald confidence interval** for a difference in two proportions with a continuity correction applied.\n\n\n::: {.callout-note}\nIn R, the `prop.test()` function uses different methods depending on whether the confidence interval is for a single proportion or a difference in two proportions.\n\n- For a single proportion, `prop.test()` gives a score confidence interval.\n- For a difference in two proportions, `prop.test()` gives a Wald confidence interval.\n:::\n\n## Question 5\n\n---\n\nUsing the data below collected from the poll in [Question 1], construct a 90% Wald confidence interval for the difference in the proportion of all Democrats and the proportion of all Republicans that do not plan to be vaccinated.\n\n| Party      | Yes, will | Yes, already | No  | Unsure | Total |\n|------------|-----------|--------------|-----|--------|-------|\n| Democrat   | 213       | 108          | 40  | 7      | 368   |\n| Republican | 93        | 70           | 120 | 9      | 292   |\n| Total      | 306       | 178          | 160 | 16     | 660   |\n\n### Solution to Question 5\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# use code cell to help\n```\n:::\n\n\n<br>  \n<br>  \n\n\n# Summarizing Results of Confidence Intervals \n\n---\n\n\n| Parameter(s) of Interest  | Point Estimate  | Distribution | Margin of Error |\n|---------------------------|-----------------|--------------|-----------------|\n| A single mean <br> ($\\sigma^2$ known) | $\\bar{x}$ | $N(0,1)$    | $z_{\\alpha/2} \\cdot \\dfrac{\\sigma}{\\sqrt{n}}$ |\n| A single mean <br> ($\\sigma^2$ unknown) | $\\bar{x}$ | <span style=\"color:mediumseagreen\">$t$-dist</span>  | ${\\color{mediumseagreen}{t_{\\alpha/2}}} \\cdot \\dfrac{{\\color{tomato}{s}}}{\\sqrt{n}}$ |\n| A difference in two means <br> (with unknown variances) | $\\bar{x}_1 - \\bar{x}_2$ | <span style=\"color:mediumseagreen\">$t$-dist</span> | ${\\color{mediumseagreen}{t_{\\alpha/2}}} \\cdot \\sqrt{ \\dfrac{{\\color{tomato}{s_1}}^2}{n_1} + \\dfrac{{\\color{tomato}{s_2}}^2}{n_2}}$ |\n| Wald for single proportion  | $\\hat{p}=\\dfrac{X}{n}$ | $N(0,1)$ | $z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{{\\color{tomato}{\\widehat{p}}}(1-{\\color{tomato}{\\widehat{p}}})}{n}}$ |\n| Agresti-Coull for single proportion  | $\\tilde{p}=\\dfrac{X+2}{n+4}$ | $N(0,1)$ | $z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{{\\color{tomato}{\\tilde{p}}}(1-{\\color{tomato}{\\tilde{p}}})}{{\\color{dodgerblue}{n+4}}}}$ |\n| Wald for a difference <br> in two proportions  | $\\hat{p}_1 - \\hat{p}_2$ | $N(0,1)$ | $z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{{\\color{tomato}{\\hat{p}_1}}(1-{\\color{tomato}{\\hat{p}_1}})}{n_1} + \\dfrac{{\\color{tomato}{\\hat{p}_2}}(1-{\\color{tomato}{\\hat{p}_2}})}{n_2}}$ |\n\n\n## A Note About Sample Sizes {#sec-samp-size}\n\n\n---\n\n- For a **single mean**, we can use the CTL to construct a parametric confidence interval as long as:\n\n  - Either the population is symmetric or $n \\geq 30$.\n  - If the sample is symmetric, we can assume the population is symmetric. \n\n- For a **difference in two means** , we can use the CTL to construct a parametric confidence interval as long as:\n\n  - Population 1 is either symmetric or $n_1 \\geq 30$, and \n  - Population 2 is either symmetric or $n_2 \\geq 30$.\n\n- For a **single proportion**, we can use the CTL to construct a parametric confidence interval as long as:\n\n  - Both $n\\hat{p} \\geq 10$ and $n(1-\\hat{p}) \\geq 10$.\n\n- For a **difference in two proportions**, we can use the CTL to construct a parametric confidence interval as long as:\n\n  - All of $n_1\\hat{p}_1 \\geq 10$,  $n_1(1-\\hat{p}_1) \\geq 10$,  $n_2\\hat{p}_2 \\geq 10$, and $n_2(1-\\hat{p}_2) \\geq 10$ are satisfied.\n\n## Useful R Functions\n\n---\n\nIn R, we have the functions:\n\n- `t.test()$conf.int` constructs a $t$-confidence interval for a single or difference in two means.\n- `prop.test()$conf.int` constructs a score confidence interval for a single proportion.\n- `prop.test()$conf.int` constructs a Wald confidence interval for a difference in two proportions.\n\n\n# Appendix\n\n---\n\n\n## Deriving the Score Confidence Interval Formulas {#sec-score}\n\n---\n\nLet $X \\sim \\mbox{Binom}(n,p)$ and consider the distribution of sample proportions, $\\widehat{P} = \\frac{X}{n}$. From the [CLT for proportions](11-Sampling-Dist-Prop.qmd#sec-clt-prop) we know $\\widehat{P} \\sim N \\left( p, \\sqrt{\\frac{p(1-p)}{n}} \\right)$. Thus, for confidence level CL, we have\n\n$$P(-z_{\\alpha/2}< Z < z_{\\alpha/2}) = P \\left( -z_{\\alpha/2} < \\frac{\\hat{p} -{\\color{tomato}{p}}}{\\sqrt{\\frac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n}}} < z_{\\alpha/2} \\right) =CL.$$\n\nThe <span style=\"color:dodgerblue\">**upper cutoff, $U$**</span> is a value for ${\\color{tomato}{p}}$ such that\n\n$$\\dfrac{\\hat{p} -{\\color{tomato}{p}}}{\\sqrt{\\dfrac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n}}} = z_{\\alpha/2}.$$\n\nTo solve for ${\\color{tomato}{p}}$, we multiply both sides of the equation above by $\\sqrt{\\dfrac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n}}$ and then square both sides giving\n\n$$\\big( \\hat{p} - {\\color{tomato}{p}} \\big)^2 = (z_{\\alpha/2})^2 \\left( \\frac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n} \\right).$$\n\nNext we distribute terms on both sides of the equation and have\n\n$$\\hat{p}^2 - 2 {\\color{tomato}{p}}\\hat{p} + {\\color{tomato}{p}}^2 = {\\color{tomato}{p}} \\left( \\frac{z_{\\alpha/2}^2}{n} \\right) - {\\color{tomato}{p}}^2 \\left( \\frac{z_{\\alpha/2}^2}{n} \\right).$$\n\nWe have a quadratic equation for the unknown ${\\color{tomato}{p}}$. We group all like terms together on one side of the equation,\n\n\n$${\\color{dodgerblue}{\\left( 1+ \\frac{z_{\\alpha/2}^2}{n} \\right)}} p^2 + {\\color{tomato}{\\left(-2\\hat{p}-\\frac{z_{\\alpha/2}^2}{n} \\right)}} p + {\\color{mediumseagreen}{\\hat{p}^2}} = {\\color{dodgerblue}{a}}p^2 + {\\color{tomato}{b}} p + {\\color{mediumseagreen}{c}} = 0.$$\nWe use the quadratic formula to solve for $p$. The quadratic equation has two real solutions, the larger of the two solution is the upper limit for a 95% score confidence interval\n\n$${\\large \\boxed{ U = \\frac{ \\hat{p} + \\dfrac{z_{\\alpha/2}^2}{2n} + z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{\\hat{p}(1-\\hat{p})}{n} + \\dfrac{z_{\\alpha/2}^2}{4n^2}}}{1+\\dfrac{z_{\\alpha/2}^2}{n}}}}$$\n\nThe smaller of the two solutions is the <span style=\"color:dodgerblue\">**lower cutoff, $L$**</span>\n\n$${\\large \\boxed{ L = \\frac{ \\hat{p} + \\dfrac{z_{\\alpha/2}^2}{2n} - z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{\\hat{p}(1-\\hat{p})}{n} + \\dfrac{z_{\\alpha/2}^2}{4n^2}}}{1+\\dfrac{z_{\\alpha/2}^2}{n}}}}$$\n\nWe also consider the equation\n\n$$\\dfrac{\\hat{p} -{\\color{tomato}{p}}}{\\sqrt{\\dfrac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n}}} = -z_{\\alpha/2}.$$\n\nIf we multiply both sides of the equation above by $\\sqrt{\\dfrac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n}}$ and then square both sides, we get\n\n$$\\big( \\hat{p} - {\\color{tomato}{p}} \\big)^2 = (-z_{\\alpha/2})^2 \\left( \\frac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n} \\right).$$\n\nThe resulting equation is the same as with the first case we solved. Thus, solving the equation above gives the same expressions for $U$ and $L$.\n\n\n## Applying a Continuity Correction {#sec-score-corr}\n\n---\n\nRecall, when using a normal distribution to approximate a discrete, binomial distribution $X \\sim \\mbox{Binom}(n,p)$, we can improve the estimate by using a [continuity correction](11-Sampling-Dist-Prop.qmd#sec-cont-corr).\n\nIn the case of a score confidence interval for a proportion, the continuity correction is applied as follows:\n\n-   In the formula for the corrected lower cutoff $L^*$, we use the corrected sample proportion ${\\color{dodgerblue}{\\hat{p}_L^*= \\dfrac{X-0.5}{n}}}$.\n-   In the formula for the corrected upper cutoff $U^*$, we use the corrected sample proportion ${\\color{tomato}{\\hat{p}_U^* = \\dfrac{X+0.5}{n}}}$.\n\n$$\\begin{aligned}\n&L^* = \\dfrac{{\\color{dodgerblue}{\\hat{p}_L^*}} + \\dfrac{z_{\\alpha/2}^2}{2n} - z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{{\\color{dodgerblue}{\\hat{p}_L^*}}(1-{\\color{dodgerblue}{\\hat{p}_L^*}})}{n} + \\dfrac{z_{\\alpha/2}^2}{4n^2}}}{1+ \\dfrac{z_{\\alpha/2}^2}{n}} \\\\\n\\\\\n&U^* = \\dfrac{{\\color{tomato}{\\hat{p}_U^*}} + \\dfrac{z_{\\alpha/2}^2}{2n} + z_{\\alpha/2} \\cdot \\sqrt{ \\dfrac{{\\color{tomato}{\\hat{p}_U^*}}(1-{\\color{tomato}{\\hat{p}_U^*}})}{n} + \\dfrac{z_{\\alpha/2}^2}{4n^2}}}{1+ \\dfrac{z_{\\alpha/2}^2}{n}}\n\\end{aligned}$$\n\n\n## CLT: Difference in Two Proportions {#sec-clt-diffprop}\n\n---\n\n\nLet $X_1 \\sim \\mbox{Binom}(n_1,p_1)$ and $X_2 \\sim \\mbox{Binom}(n_2,p_2)$ be two independent binomial random variables with distribution of sample proportions $\\widehat{P}_1 = \\frac{X_1}{n_1}$ and $\\widehat{P}_2 = \\frac{X_2}{n_2}$, respectively. As long as [both samples are large enough](#sec-samp-size), the sampling distribution for the difference in sample proportions $\\widehat{P_1}-\\widehat{P_2}$ will:\n\n-   Be approximately <span style=\"color:dodgerblue\">**normally distributed**</span>.\n-   Have mean ${\\color{dodgerblue}{E(\\widehat{P_1}-\\widehat{P_2}) = \\mu_{\\widehat{P}_1 - \\widehat{P}_2} =p_1 - p_2}}$.\n-   Have <span style=\"color:dodgerblue\">**standard error**</span> \n$${\\color{dodgerblue}{\\mbox{SE}(\\widehat{P}_1 - \\widehat{P}_2) =  \\sqrt{\\frac{p_1(1-p_1)}{n_1} + \\frac{p_2(1-p_2)}{n_2}}}}.$$\n\nWe summarize the results of the <span style=\"color:dodgerblue\">**Central Limit Theorem (CLT) for a Difference in Two Proportions**</span> more concisely below:\n\n$${\\color{dodgerblue}{\\boxed{ \\widehat{P}_1 - \\widehat{P}_2  \\sim N \\left( \\mu_{\\widehat{P}_1 - \\widehat{P}_2} , \\mbox{SE}(\\widehat{P}_1 - \\widehat{P}_2) \\right) = N \\left( p_1 - p_2  , \\sqrt{\\frac{p_1(1-p_1)}{n_1} + \\frac{p_2(1-p_2)}{n_2}} \\right)}}}.$$\n\n### Proof of CLT for Difference in Two Proportions\n\n---\n\nBelow we prove both $E(\\widehat{P_1}-\\widehat{P_2}) = \\mu_{\\widehat{P}_1 - \\widehat{P}_2} =p_1 - p_2$ and $\\mbox{SE}(\\widehat{P}_1 - \\widehat{P}_2) =  \\sqrt{\\frac{p_1(1-p_1)}{n_1} + \\frac{p_2(1-p_2)}{n_2}}$. \n\n\n#### Mean of Sampling Distribution for $\\widehat{P}_1 - \\widehat{P}_2$\n\n---\n\nWe have $E (\\widehat{P_1}-\\widehat{P_2}) = E \\left( \\frac{X_1}{n_1} -\\frac{X_2}{n_2} \\right)$. Using [properties of expected value](06-Expected-Value-and-Variance.qmd#sec-prop-exp), we have\n\n$$E (\\widehat{P_1}-\\widehat{P_2}) = E \\left( \\frac{X_1}{n_1} -\\frac{X_2}{n_2} \\right) = \\frac{1}{n_1} E(X_1) - \\frac{1}{n_2} E(X_2).$$\n\nSince $X_1 \\sim \\mbox{Binom}(n_1,p_1)$ and $X_2 \\sim \\mbox{Binom}(n_2,p_2)$, we know ${\\color{dodgerblue}{E(X_1) = n_1p_1}}$ and ${\\color{tomato}{E(X_2) = n_2p_2}}$. Thus we have\n\n$$E (\\widehat{P_1}-\\widehat{P_2}) = \\frac{1}{n_1} {\\color{dodgerblue}{n_1p_1}} - \\frac{1}{n_2} {\\color{tomato}{n_2p_2}}=p_1-p_2.$$\n\nThis concludes the proof that $E (\\widehat{P_1}-\\widehat{P_2}) =p_1-p_2$.\n\n\n#### Standard Error of Sampling Distribution for $\\widehat{P}_1 - \\widehat{P}_2$\n\n---\n\nWe have $\\mbox{Var} (\\widehat{P_1}-\\widehat{P_2}) = \\mbox{Var} \\left( \\frac{X_1}{n_1} -\\frac{X_2}{n_2} \\right)$. $X_1$ and $X_2$ are independent random variables, so we can use [properties of variance](06-Expected-Value-and-Variance.qmd#sec-prop-var):\n\n$$\\mbox{Var} \\left( \\frac{X_1}{n_1} -\\frac{X_2}{n_2} \\right) = \\left(\\frac{1}{n_1}\\right)^2 \\mbox{Var}(X_1) + \\left(- \\frac{1}{n_2} \\right)^2 \\mbox{Var}(X_2) = \\frac{1}{n_1^2}\\mbox{Var}(X_1) + \\frac{1}{n_2^2}\\mbox{Var}(X_2).$$\n\nSince $X_1 \\sim \\mbox{Binom}(n_1,p_1)$ and $X_2 \\sim \\mbox{Binom}(n_2,p_2)$, we know ${\\color{dodgerblue}{\\mbox{Var}(X_1) = n_1p_1(1-p_1)}}$ and ${\\color{tomato}{\\mbox{Var}(X_2) = n_2p_2(1-p_2)}}$. Thus we have\n\n$$\\mbox{Var} (\\widehat{P_1}-\\widehat{P_2}) = \\frac{1}{n_1^2} {\\color{dodgerblue}{n_1p_1(1-p_1)}} - \\frac{1}{n_2^2} {\\color{tomato}{n_2p_2(1-p_2)}}= \\frac{p_1(1-p_1)}{n_1} + \\frac{p_2(1-p_2)}{n_2}.$$\n\nThe standard error of the sampling distribution is the square root of the variance, thus we have\n\n$$\\mbox{SE} (\\widehat{P_1}-\\widehat{P_2}) = \\sqrt{\\frac{p_1(1-p_1)}{n_1} + \\frac{p_2(1-p_2)}{n_2}}.$$\n\n---\n\n![Creative Commons License](https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png) <nbsp>\n\n*Statistical Methods: Exploring the Uncertain* by [Adam Spiegler](https://github.com/CU-Denver-MathStats-OER/Statistical-Theory) is licensed under a [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-nc-sa/4.0/).\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}