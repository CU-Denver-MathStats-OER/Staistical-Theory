{
  "hash": "8072186d3563d3d7a01d6777a17083ee",
  "result": {
    "markdown": "---\ntitle: '5.2: Bootstrap Confidence Intervals'\n#author: 'Adam Spiegler, University of Colorado Denver'\nexecute:\n  eval: false\noutput:\n  html_document:\n#    toc: yes\n#    toc_depth: 1\n#    theme: cerulean\n#jupyter:\n#  kernelspec:\n#    display_name: R\n#    language: R\n#    name: ir\n#output:\n#    ipynbdocument::ipynb_document\n---\n\n\n\n[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://githubtocolab.com/CU-Denver-MathStats-OER/Statistical-Theory/blob/main/Chap5/17-Bootstrap-Confidence-Int.ipynb){target=\"_blank\"} &nbsp;\n\n\nIn our [work with bootstrap distributions](16-Bootstrap-Dist.qmd), we explored how we can used data from one random sample picked from a population with unknown parameters to construct an approximation for a sampling distribution. From a bootstrap distribution, we can define a new estimator:\n\n- We defined the <span style=\"color:dodgerblue\">estimator $\\hat{\\theta}_{\\rm{boot}}$</span> as the mean (expected) value of the bootstrap distribution.\n- We use the <span style=\"color:dodgerblue\">bootstrap standard error</span> to estimate the variability or uncertainty in estimates due to the randomness of sampling.\n- We defined the <span style=\"color:dodgerblue\">bootstrap estimate of bias</span> as $\\mbox{Bias}_{\\rm{boot}} \\big( \\hat{\\theta}_{\\rm{boot}} \\big) = \\hat{\\theta}_{\\rm{boot}} - \\left( \\mbox{observed sample statististic} \\right)$.\n  - For example, in the case of estimating a population mean $\\mu$, we have ${\\color{dodgerblue}{\\mbox{Bias}_{\\rm{boot}} \\big( \\hat{\\mu}_{\\rm{boot}} \\big) = \\hat{\\mu}_{\\rm{boot}} - \\bar{x}}}$.\n\nIn this section we will discuss how we can use the bootstrap standard error to account for the uncertainty in our estimate and to incorporate that uncertainty in our final estimate.\n\n\n# Case Study: Ozone Concentration in New York City\n\n---\n\n![Credit: [Northeast States for Coordinated Air Use Management (NESCAUM)](https://www-f.nescaum.org/documents/listos)](https://www-f.nescaum.org/documents/listos/AQI_Map_170518.png){fig-align=\"left\" width=65% fig-alt=\"Map of Air Quality in Northeastern US\"}\n\nAccoording to the Unites States Environmental Protection Agency (EPA)^[<https://www.epa.gov/ozone-pollution-and-your-patients-health/what-ozone> accessed June 26, 2023]:\n\n> Ozone (O3) is a highly reactive gas composed of three oxygen atoms. It is both a natural and a man-made product that occurs in the Earth's upper atmosphere (the stratosphere) and lower atmosphere (the troposphere).  Depending on where it is in the atmosphere, ozone affects life on Earth in either good or bad ways.\n\n\nWhen the ozone concentration is greater, respiratory illnesses such as asthma, pneumonia, and bronchitis can become exacerbated. While the effects of short-term exposure to high ozone concentration are reversible, long-term exposure may not be reversible. The EPA sets Ozone National Ambient Air Quality Standards (NAAQS)^[[Ozone Air Quality Standards acccessed from EPA June 26, 2023](https://www.epa.gov/naaqs/ozone-o3-air-quality-standards)]. \"The existing primary and secondary standards, established in 2015, are 0.070 parts per million (ppm)\", or equivalently 70 parts per billion (pbb).\n\nWe will begin todays work with bootstrap distributions investigating the following question:\n\n> **Is the population of New York City experiencing  long-term exposure to unhealthy levels of ozone?**\n\n\n## Loading NYC Ozone Data\n\n---\n\nIt is very likely you do not have the package `lattice` installed. You will need to first install the `lattice` package.\n\n- Go to the R Console window.\n- Run the command `> install.packages(\"lattice\")`. \n\nYou will only need to run the `install.package()` command one time. You can now access `lattice` anytime you like! However, you will need to run the command `library(lattice)` during any R session in which you want to access data from the `lattice` package.  **Be sure you have first installed the `lattice` package before executing the code cell below.**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# be sure you have already installed the lattice package\nlibrary(lattice)  # loading permute package\n```\n:::\n\n\n\n### Summarizing and Storing the Data\n\n---\n\nIn the code cell below we summarize a data frame^[Bruntz, Cleveland, Kleiner, and Warner. (1974). \"The Dependence of Ambient Ozone on Solar Radiation, Wind, Temperature, and Mixing Height\". In *Symposium on Atmospheric Diffusion and Air Pollution*. American Meterological Society, Boston.] named `environmental` from the `lattice` package and store the ozone concentration data `environmental$ozone` to a vector named `nyc.oz`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(environmental)  # numerical summary of each variable\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     ozone         radiation      temperature         wind       \n Min.   :  1.0   Min.   :  7.0   Min.   :57.00   Min.   : 2.300  \n 1st Qu.: 18.0   1st Qu.:113.5   1st Qu.:71.00   1st Qu.: 7.400  \n Median : 31.0   Median :207.0   Median :79.00   Median : 9.700  \n Mean   : 42.1   Mean   :184.8   Mean   :77.79   Mean   : 9.939  \n 3rd Qu.: 62.0   3rd Qu.:255.5   3rd Qu.:84.50   3rd Qu.:11.500  \n Max.   :168.0   Max.   :334.0   Max.   :97.00   Max.   :20.700  \n```\n:::\n\n```{.r .cell-code}\nnyc.oz <- environmental$ozone  # store ozone data to a vector\n```\n:::\n\n\n\n## Question 1\n\n---\n\nWe will use the sample data stored in `nyc.oz` to construct a bootstrap distribution that we can use to make predictions about the population of all times in New York City. Answer the questions below to get acquainted with the sample data.\n\n\n### Question 1a\n\n---\n\nHow many observations are in the sample stored in `nyc.oz`? Describe the shape of the data in `nyc.oz`.\n\n\n#### Solution to Question 1a\n\n---\n\n<br>  \n<br>  \n<br>  \n\n### Question 1b\n\n---\n\nBased on the sample data in `nyc.oz`, give an estimate for the mean ozone concentration in New York City (over all days and times). \n\n\n#### Solution to Question 1b\n\n---\n\n<br>  \n<br>  \n<br>  \n\n\n\n# Bootstrap Distribution for a Proportion\n\n---\n\nThe sample mean for ozone concentration is below the 70 ppb limit. However, from the plot in [Question 1a], we see there are number of observations in the sample with an ozone concentration over 70 ppb.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(nyc.oz > 70)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 24\n```\n:::\n:::\n\n\n> What proportion of time in NYC is the ozone concentration greater than 70 ppb?\n\nThe sample proportion of observations with an ozone concentration greater than 70 pbb is $24/111  \\approx 0.2162$. We calculate the sample proportion in two different ways below. In both methods, we use the logical test `nyc.oz > 70` to help count the number of observations greater than 70 pbb.\n\n1. Using a logical test in a `sum()` command and dividing by the sample size `n`.\n2. Using a logical test in a `mean()` command sums and divides by $n$ at once.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# method 1\nn <- length(nyc.oz)  # number of observations in sample\nsum(nyc.oz > 70) / n  # sample proportion over 70 ppb\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.2162162\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# method 2\nmean(nyc.oz > 70)  # sample proportion over 70 ppb\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.2162162\n```\n:::\n:::\n\n\n\nBoth methods are equivalent and we see that \n\n$$\\hat{p} = 0.2162 = 21.62 \\%.$$\nThus use the plug-in principle, a reasonable estimate for the proportion of all time that the ozone concentration in NYC is over 70 ppb (we denote the population proportion $p$) is\n\n$$ p \\approx \\hat{p} = 0.2612.$$\nHow certain can we be in this estimate? If we pick another sample of observations, would we get a similar estimate for $p$, or should we expect a lot of variability?\n\n## Question 2\n\n---\n\nAnswer each part below to construct a bootstrap distribution for the sample proportion. Then use the result to answer the questions that follow.\n\n\n### Question 2a\n\n---\n\nComplete the code cell below to construct a bootstrap distribution for the sample proportion of observations with ozone concentration greater than 70 ppb. \n\n::: {.callout-tip}\nThere are two operations to complete inside the for loop:\n\n1. Pick a bootstrap resample from the observed sample `nyc.oz`.\n2. Calculate the proportion of observations in the bootstrap resample with ozone concentration greater than 70 ppb.\n\n:::\n\n\n#### Solution to Question 2a\n\n---\n\nReplace all six `??` in the code cell below with appropriate code. Then run the completed code to generate a bootstrap distribution and mark the observed sample proportion (in red) and the mean of the bootstrap distribution (in blue) with vertical lines.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nN <- 10^5  # Number of bootstrap samples\nboot.prop <- numeric(N)  # create vector to store bootstrap proportions\n\n# for loop that creates bootstrap dist\nfor (i in 1:N)\n{\n  x <- sample(??, size = ??, replace = ??)  # pick a bootstrap resample\n  boot.prop[i] <- ??  # compute bootstrap sample proportion\n}\n\n# plot bootstrap distribution\nhist(boot.prop,  \n     breaks=20, \n     xlab = \"p-hat, sample proportion\",\n     main = \"Bootstrap Distribution for Sample Proportion\")\n\n# red line at the observed sample proportion\nabline(v = ??, col = \"firebrick2\", lwd = 2, lty = 1)\n\n# blue line at the center of bootstrap dist\nabline(v = ??, col = \"blue\", lwd = 2, lty = 2)\n```\n:::\n\n\n### Question 2b\n\n---\n\nBased on your answer to [Question 2a], calculate bootstrap estimate for bias. Note answers will vary due to the randomness of bootstrapping in [Question 2a].\n\n\n#### Solution to Question 2b\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# calculate bootstrap estimate of bias\n```\n:::\n\n\n<br>  \n<br>  \n\n\n### Question 2c\n\n---\n\nBased on your answer to [Question 2a], calculate the bootstrap estimate for the standard error of the sampling distribution for sample proportions. Note answers will vary due to the randomness of bootstrapping in [Question 2a].\n\n\n#### Solution to Question 2c\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# calculate bootstrap standard error\n```\n:::\n\n\n<br>  \n<br>  \n\n\n# Comparing Bootstrapping to CLT\n\n---\n\nRecall the [Central Limit Theorem (CLT) for Proportions](11-Sampling-Dist-Prop.qmd),\n\n$$\\widehat{P} \\sim N \\left( \\mu_{\\hat{P}}, \\mbox{SE}(\\widehat{P}) \\right) = \\left( {\\color{tomato}{p}}, \\sqrt{\\frac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n}} \\right).$$\n\nThe population proportion $p$ is unknown, but we can use the plug-in principle and use the sample proportion ${\\color{tomato}{\\hat{p} = 0.2162}}$ in place to estimate the sampling distribution for the sample proportion:\n\n$$\\begin{aligned}\n\\widehat{P} \\sim N \\left( \\mu_{\\hat{P}}, \\mbox{SE}(\\widehat{P}) \\right) &= \\left( {\\color{tomato}{p}}, \\sqrt{\\frac{{\\color{tomato}{p}}(1-{\\color{tomato}{p}})}{n}} \\right) \\\\\n& \\approx N\\left( {\\color{tomato}{0.2162}}, \\sqrt{\\frac{{\\color{tomato}{0.2162}}(1-{\\color{tomato}{0.2162}})}{111}} \\right) \\\\\n& \\approx N( 0.2162, 0.0391).\n\\end{aligned}$$\n\n\n| Method  | Mean of Sampling Distribution | Standard Error |\n|---------|-------------------------------|----------------|\n| Bootstrap^[Answers from [Question 2] may vary] | $0.2164$ | $0.0390$ |\n| CLT with $\\hat{p}$ in place of $p$  | $0.2162$  | $0.0391$  |\n\n\nThe two methods, bootstrap distribution and the estimate from using the CLT, give us consistent results!\n\n\n# Interval and Point Estimates {#sec-fishing}\n\n---\n\n\nUsually when estimating an unknown population parameter, we give an <span style=\"color:dodgerblue\">**interval estimate**</span> that gives range of plausible values for the parameter by accounting for the uncertainty due to the variability in sampling.\n\n-   For example, using both mean and standard error from the bootstrap distribution in [Question 2c], we could say\n\n$$ p_{\\rm over} \\approx \\hat{p}_{\\rm boot} \\color{dodgerblue}{\\pm \\mbox{SE}_{\\rm boot} \\left( \\widehat{P} \\right)} = 0.216 \\color{dodgerblue}{\\pm 0.039}.$$\n\n  -    An interval of plausible values for $p$ is from $0.177$ to $0.255$.  \n\n-   An estimate for a parameter with a single value is called a <span style=\"color:dodgerblue\">**point estimate**</span>.\n\n    -   Since there is variability from sample to sample, it is not very likely that our point estimate is perfectly accurate, but it is likely close.\n    -   We get a very specific estimate that is very unlikely to equal the actual parameter value.\n    -   <span style=\"color:tomato\">**This is like trying to catch a fish with a spear.**</span>\n\n-   An estimate for a parameter with a range of values is called an <span style=\"color:dodgerblue\">**interval estimate**</span>.\n\n    -   By building some uncertainty into our estimate, we can be more confident the actual value of the parameter is somewhere inside the interval.\n    -   However, our estimate is less specific.\n    -   <span style=\"color:mediumseagreen\">**This is like trying to catch a fish with a net.**</span>\n    - We are more likely to catch fish even if we do not know specifically where the fish is! \n\n-   <span style=\"color:dodgerblue\">**We frequently estimate parameters with interval to account for the variability of sample statistics.**</span>\n\n::: {layout=\"[[47,53]]\" #fig-fishing}\n\n![Credit: Rahil, [Public Domain](https://creativecommons.org/share-your-work/public-domain/cc0/), [Pixahive](https://pixahive.com/photo/man-throwing-a-fishing-net/)](https://i0.wp.com/pixahive.com/wp-content/uploads/2020/09/Man-Throwing-a-Fishing-Net-79117-pixahive.jpg?fit=778%2C518&ssl=1){fig-alt=\"Man Throwing a Fishing Net\"}\n\n![Credit: [Townsend, C. H](https://garystockbridge617.getarchive.net/amp/media/fmib-48360-indian-sealing-canoe-showing-method-of-throwing-spear-7cbd5a). (1898), Public Domain](https://cdn2.picryl.com/photo/1898/12/31/fmib-48360-indian-sealing-canoe-showing-method-of-throwing-spear-7cbd5a-1024.jpeg){fig-alt=\"Sealing Canoe Showing Method of Throwing Spear\"}\n\nFishing with an interval estimate compared to a point estimate.\n:::\n\n\n# A 95% Bootstrap Percentile Confidence Interval\n\n---\n\nThe interval between the $2.5$ and $97.5$ percentiles (or $0.025$ and $0.975$ quantiles) of the bootstrap distribution of a statistic is a <span style=\"color:dodgerblue\">**95% bootstrap percentile confidence interval**</span> for the corresponding parameter.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Finding Cutoffs for a 95% Bootstrap Percentile Confidence Interval](17-Bootstrap-Confidence-Int_files/figure-html/fig-confint-1.png){#fig-confint width=672}\n:::\n:::\n\n\n\n-   If most of the sample statistics are located in a certain interval of the bootstrap distribution, it seems plausible the true value of the parameter is in this interval!\n-   We would say we are 95% confident that the interval contains the actual value of the population parameter since 95% of the bootstrap resamples are inside this interval.\n-   In general, <span style=\"color:dodgerblue\">**confidence interval estimates give a range of plausible values for the unknown value of the parameter**</span>.\n\n## Question 3\n\n---\n\nIn [Question 2], we created a bootstrap distribution (stored in the vector `boot.prop`) for the sample proportion of times the ozone concentration exceeds 70 ppb. One possible bootstrap distribution is plotted below. Bootstrap distributions will vary slightly depending on the 100,000 bootstrap resamples that are randomly selected.\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# plot bootstrap distribution\nhist(boot.prop,  \n     breaks=20, \n     xlab = \"p-hat, sample proportion\",\n     main = \"Bootstrap Distribution for Sample Proportion\")\n\n# red line at the observed sample proportion\nabline(v = mean(nyc.oz > 70), col = \"firebrick2\", lwd = 2, lty = 1)\n\n# blue line at the center of bootstrap dist\nabline(v = mean(boot.prop), col = \"blue\", lwd = 2, lty = 2)\n```\n\n::: {.cell-output-display}\n![](17-Bootstrap-Confidence-Int_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n### Question 3a\n\n---\n\nUsing the bootstrap statistics stored in `boot.prop`, find the lower and upper cutoffs for a 95% bootstrap percentile confidence interval for the proportion of all times the ozone concentration in NYC exceeds 70 ppb.\n\n:::{.callout-tip}\nRecall the `quantile()` function in R. Run the command `?quantile` for a refresher!\n:::\n\n\n#### Solution to Question 3a\n\n---\n\nReplace all four `??` in the code cell below with appropriate code. Then run the completed code to compute lower and upper cutoffs for a 95% bootstrap percentile confidence interval.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# find cutoffs for 95% bootstrap CI\nlower.boot.95 <- quantile(??, probs = ??)  # find lower cutoff\nupper.boot.95 <- quantile(??, probs = ??)  # find upper cutoff\n\n# print values to screen\nlower.boot.95\nupper.boot.95\n```\n:::\n\n\n**Based on the output above, a 95% bootstrap percentile confidence interval is from ?? to ??.**\n\n<br>  \n<br>\n\n\n### Question 3b\n\n---\n\n\nThe code cell below plots a bootstrap distribution corresponding of the sample proportions stored in `boot.prop` along with two blue vertical lines to mark the lower and upper cutoffs for a 95% bootstrap percentile confidence interval. A red vertical line marks the value of the sample proportion we calculated from the original sample.\n\nRun the code cell below to illustrate the confidence interval on the bootstrap distribution. There is nothing to edit in the code cell. Then in the space below, explain the practical meaning of the interval to a person with little to no background in statistics.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#################################\n# code is ready to run!\n# no need to edit the code cell\n#################################\n\n# plot bootstrap distribution\nhist(boot.prop,  \n     breaks=20, \n     xlab = \"p-hat, sample proportion\",\n     main = \"Bootstrap Distribution for Sample Proportion\")\n\n# red line at the observed sample proportion\nabline(v = mean(nyc.oz > 70), col = \"firebrick2\", lwd = 2, lty = 1)\n\n# blue lines marking cutoffs\nabline(v = lower.boot.95, col = \"blue\", lwd = 2, lty = 2)\nabline(v = upper.boot.95, col = \"blue\", lwd = 2, lty = 2)\n```\n\n::: {.cell-output-display}\n![](17-Bootstrap-Confidence-Int_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n#### Solution to Question 3b\n\n---\n\nInterpret the confidence interval from [Question 3a].\n\n<br>  \n<br>  \n<br>  \n\n\n### Question 3c\n\n---\n\nSometimes, it is desirable to describe the interval as some value plus or minus some margin of error. Construct a <span style=\"color:dodgerblue\">**symmetric 95% bootstrap confidence interval**</span> for the proportion of time the ozone concentration in NYC exceeds 70 ppb. Compare the symmetric confidence interval to your percentile confidence interval in [Question 3a].\n\n::: {.callout-tip}\nRecall for normal distributions, approximately 95% of the data is within 2 standard deviations of center of the distribution.\n:::\n\n#### Solution to Question 3c\n\n---\n\nReplace each `??` in the code cell below with appropriate code.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n?? - 2*??  # going 2 SE's below the observed sample proportion\n?? + 2*??  # going 2 SE's above the observed sample proportion\n```\n:::\n\n\n**Based on the output above, a symmetric 95% bootstrap confidence interval is from ?? to ??.**\n\n<br>  \n<br>\n\n\n# Adjusting the Confidence Level\n\n---\n\nWe would expect the actual value of the unknown population parameter to equal the corresponding statistic calculated from one of the 100,000 bootstrap resamples in our distribution. Since 95% of the bootstrap statistics are inside the confidence interval:\n\n> **There is about a 95% chance the bootstrap percentile confidence interval contains the actual value of the population paramter.**\n\nThe <span style=\"color:dodgerblue\">**confidence level**</span> is the success rate of success of the interval estimate. We can choose differenet confidence levels for an interval estimate:\n\n- A 95% confidence level is most common.\n- Other common confidence levels are 80%, 90%, 99% and 99.9%.\n- We choose a confidence level. It is not something we calculate.\n- **What happens to an interval estimate when we change the confidence level?**\n\n\n## Question 4\n\n---\n\nIn [Question 2], we created a bootstrap distribution (stored in the vector `boot.prop`) for the sample proportion of times the ozone concentration exceeds 70 ppb. In [Question 3], we used the bootstrap distribution to construct a 95% bootstrap percentile confidence interval. In this question, we will investigate what happens when we change the confidence level.\n\n### Question 4a\n\n---\n\nComplete the first code cell below to give a 90% bootstrap percentile confidence interval to estimate the proportion of all time in NYC when the ozone concentration exceeds 70 ppb.\n\nThen complete the second code cell to plot a histogram of the bootstrap distribution from with the upper and lower confidence interval cutoffs marked with vertical lines similar to the plot in [Question 3b].\n\n\n#### Solution to Question 4a\n\n---\n\n\n**Based on the output below, a 90% bootstrap percentile confidence interval is from ?? to ??.**\n\n<br>  \n<br>\n\n\nReplace all four `??` in the code cell below with appropriate code. Then run the completed code to compute lower and upper cutoffs for a 90% bootstrap percentile confidence interval.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# find cutoffs for 90% bootstrap CI\nlower.prop.90 <- quantile(??, probs = ??)  # find lower cutoff\nupper.prop.90 <- quantile(??, probs = ??)  # find upper cutoff\n\n# print to screen\nlower.prop.90\nupper.prop.90\n```\n:::\n\n\nNothing to edit in the code cell below. Just be sure you first run the code cell above to calculate and store the cutoffs `lower.prop.90` and `upper.prop.90`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##################################\n# code is ready to run!\n# no need to edit the code cell\n##################################\n\n# plot bootstrap distribution\nhist(boot.prop,  \n     breaks=20, \n     xlab = \"p-hat, sample proportion\",\n     main = \"Bootstrap Distribution for Sample Proportion\")\n\n# red line at the observed sample proportion\nabline(v = mean(nyc.oz > 70), col = \"firebrick2\", lwd = 2, lty = 1)\n\n# blue lines marking cutoffs\nabline(v = lower.boot.90, col = \"blue\", lwd = 2, lty = 2)\nabline(v = upper.boot.90, col = \"blue\", lwd = 2, lty = 2)\n```\n:::\n\n\n\n### Question 4b\n\n---\n\nComplete the first code cell below to give a 99% bootstrap percentile confidence interval to estimate the proportion of all time in NYC when the ozone concentration exceeds 70 ppb.\n\nThen complete the second code cell to plot a histogram of the bootstrap distribution from with the upper and lower confidence interval cutoffs marked with vertical lines similar to the plot in [Question 3b].\n\n\n#### Solution to Question 4b\n\n---\n\n\n**Based on the output below, a 99% bootstrap percentile confidence interval is from ?? to ??.**\n\n<br>  \n<br>\n\n\nReplace all four `??` in the code cell below with appropriate code. Then run the completed code to compute lower and upper cutoffs for a 90% bootstrap percentile confidence interval.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# find cutoffs for 99% bootstrap CI\nlower.prop.99 <- quantile(??, probs = ??)  # find lower cutoff\nupper.prop.99 <- quantile(??, probs = ??)  # find upper cutoff\n\n# print to screen\nlower.prop.99\nupper.prop.99\n```\n:::\n\n\nNothing to edit in the code cell below. Just be sure you first run the code cell above to calculate and store the cutoffs `lower.prop.99` and `upper.prop.99`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##################################\n# code is ready to run!\n# no need to edit the code cell\n##################################\n\n# plot bootstrap distribution\nhist(boot.prop,  \n     breaks=20, \n     xlab = \"p-hat, sample proportion\",\n     main = \"Bootstrap Distribution for Sample Proportion\")\n\n# red line at the observed sample proportion\nabline(v = mean(nyc.oz > 70), col = \"firebrick2\", lwd = 2, lty = 1)\n\n# blue lines marking cutoffs\nabline(v = lower.boot.99, col = \"blue\", lwd = 2, lty = 2)\nabline(v = upper.boot.99, col = \"blue\", lwd = 2, lty = 2)\n```\n:::\n\n\n\n\n### Question 4c\n\n---\n\nWhen we decreased the confidence level from 95% in [Question 3a] to 90% in [Question 4a],  did the interval estimate get wider or more narrow? Explain why this makes practical sense. Feel free to explain using the [fishing analogy](#sec-fishing) from earlier.\n\n#### Solution to Question 4c\n\n---\n\n<br>  \n<br>  \n<br>  \n\n### Question 4d\n\n---\n\nExplain the trade-off between choosing a confidence level and the precision of the interval estimate. In particular, why would choose a 95% confidence interval over an interval that has a greater chance of success, such as a  99% confidence interval?\n\n\n#### Solution to Question 4d\n\n---\n\n<br>  \n<br>  \n<br>  \n\n\n# Comparing Two Independent Populations\n\n---\n\n![Credit: iStock](https://static01.nyt.com/images/2020/01/28/well/physed-babies/physed-babies-jumbo.jpg?quality=75&auto=webp){fig-align=\"left\" width=50% fig-alt=\"Toddlers\"}\n\n\nOften in a study, we may be interested in determining whether there is an association between different variables. For example, we can ask:\n\n> Does smoking during pregnancy have an affect on the weight of the baby at birth?\n\n\n## Question 5\n\n---\n\nExplain how you could design a study to collect data that could help determine whether smoking during pregnancy has an affect on the weight of the baby at birth. \n\n### Solution to Question 5\n\n---\n\n<br>  \n<br>  \n<br>  \n\n\n# Case Study: Smoking and Birth Weights\n\n---\n\n\nTo help explore this question, we will use a sample of data in the data frame^[Baystate Medical Center, Springfield, Massachusetts] `birthwt` that is in the package `MASS` which should already be installed. In the code cell below, the `MASS` package is loaded and numerical summaries for all variables in `birthwt` are computed and displayed.\n\n## Loading the Birth Weight Sample\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)  # load MASS package\nsummary(birthwt)  # summary of data frame\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      low              age             lwt             race      \n Min.   :0.0000   Min.   :14.00   Min.   : 80.0   Min.   :1.000  \n 1st Qu.:0.0000   1st Qu.:19.00   1st Qu.:110.0   1st Qu.:1.000  \n Median :0.0000   Median :23.00   Median :121.0   Median :1.000  \n Mean   :0.3122   Mean   :23.24   Mean   :129.8   Mean   :1.847  \n 3rd Qu.:1.0000   3rd Qu.:26.00   3rd Qu.:140.0   3rd Qu.:3.000  \n Max.   :1.0000   Max.   :45.00   Max.   :250.0   Max.   :3.000  \n     smoke             ptl               ht                ui        \n Min.   :0.0000   Min.   :0.0000   Min.   :0.00000   Min.   :0.0000  \n 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.0000  \n Median :0.0000   Median :0.0000   Median :0.00000   Median :0.0000  \n Mean   :0.3915   Mean   :0.1958   Mean   :0.06349   Mean   :0.1481  \n 3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:0.00000   3rd Qu.:0.0000  \n Max.   :1.0000   Max.   :3.0000   Max.   :1.00000   Max.   :1.0000  \n      ftv              bwt      \n Min.   :0.0000   Min.   : 709  \n 1st Qu.:0.0000   1st Qu.:2414  \n Median :0.0000   Median :2977  \n Mean   :0.7937   Mean   :2945  \n 3rd Qu.:1.0000   3rd Qu.:3487  \n Max.   :6.0000   Max.   :4990  \n```\n:::\n:::\n\n\n\n## Question 6\n\n--- \n\nHow many observations are in the data set? How many variables? Which variables are categorical and which are quantitative? Which variables are most important in helping determine whether smoking during pregnancy has an affect on the weight of the baby at birth?\n\n### Solution to Question 6\n\n---\n\n<br>  \n<br>  \n<br>  \n\n\n## Cleaning the Birth Weight Data\n\n---\n\nThe variable `smoke` is being stored as a quantitative variable.\n\n- Pregnant parents that did not smoke have a `smoke` value equal to `0`.\n- Pregnant parents that were smokers have a `smoke` value equal to `1`.\n- Run the code cell below to make these categories more clearly labeled.\n  - Non-smokers are assigned a value of `no`.\n  - Smokers are assigned a value of `smoker`.\n  - We use the `factor()` command to convert the `smoke` variable to a categorical variable.\n  - The output tells us out of 189 parents, 115 self-identified as non-smokers and 74 as smokers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbirthwt$smoke[birthwt$smoke == 0]  <- \"no\"\nbirthwt$smoke[birthwt$smoke == 1]  <- \"smoker\"\nbirthwt$smoke <- factor(birthwt$smoke)\nsummary(birthwt$smoke)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    no smoker \n   115     74 \n```\n:::\n:::\n\n\n\n## Question 7\n\n---\n\nComplete the code cell below to create a side-by-side box plots to compare the distribution of weights for smokers and non-smokers. \n\n#### Solution to Question 7\n\n---\n\nReplace each `??` in the code cell below to generate side-by-side box plots for comparison.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create side by side box plots\nplot(?? ~ ??, data = ??,\n     col = c(\"springgreen4\", \"firebrick2\"),\n     main = \"Comparison of Birth Weights from Smokers and Non-Smokers\",\n     xlab = \"Smoking Status of Pregnant Parent\",\n     ylab = \"Birth Weight (in grams)\",\n     names = c(\"Non-smoker\", \"Smoker\"))\n```\n:::\n\n\n\n<br>  \n<br>  \n\n## Difference in Two Independent Means\n\n---\n\nOur statistical question is:\n\n> Does smoking during pregnancy have an affect on the weight of the baby at birth?\n\nIn this example, we have two independent populations of parents to consider.\n\n- All parents that did no smoke during pregnancy.\n- All parents that smoke during pregnancy.\n- You are either in one group or the other, not both!\n\nIdeally, if we had access to data on every baby that has been born, then we could:\n\n- Calculate $\\mu_{\\rm{non}}$, the mean birth weight of all children of non-smokers.\n- Calculate $\\mu_{\\rm{smoker}}$, the mean birth weight of all children of smokers.\n- Consider how large is the difference in the two means, $\\mu_{\\rm{non}} - \\mu_{\\rm{smoker}}$.\n  - If the difference in populations means is 0, there is no difference in mean birth weights.\n  - If the difference is not 0, then there is a difference in mean birth weights.\n\nWe have data from a random sample, but we plug that data in place of the population and perform an equivalent analysis.\n\n- Calculate $\\bar{x}_{\\rm{non}}$, the *sample mean* birth weight of children of non-smokers in the sample.\n- Calculate $\\bar{x}_{\\rm{smoker}}$, the *sample mean* birth weight of children of smokers in the sample.\n- Consider how large is the difference in the two means, $\\bar{x}_{\\rm{non}} - \\bar{x}_{\\rm{smoker}}$.\n  - If the difference is *close to zero*, this indicates there is likely no difference in the population means.\n  - If the difference is *not close to zero*, this indicates there likely is a difference in the population means.\n  \n  \n## Subsetting the Sample\n\n---\n\nAt the moment, we have all of the sample data for smokers and non-smokers stored in the same data frame named `birthwt`. How can we calculate the sample mean birth weights for the non-smoking group separate from the smoking group? One way to compare the two samples is to split the sample into two independent subsets based on whether or not the child was birthed by a smoker or not.\n\n## Question 8\n\n---\n\nAnswer the questions to find an initial estimate for the difference in the mean birth weights of all children born to a non-smoking parent compared to the mean birth weight of all children born to a parent that did smoke while pregnant.\n\n\n### Question 8a\n\n---\n\n\nComplete each of the `subset()` commands below to subset the data into two independent samples: parent was a smoker and parent was a non-smoker.\n\n#### Solution to Question 8a\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# subset the sample into two independent samples\nnon <- subset(??, smoke == ??)\nsmoker <- subset(??, smoke == ??)\n```\n:::\n\n\n\n<br>  \n<br>  \n\n### Question 8b\n\n---\n\nComplete the code cell below to calculate, store, and print the difference in sample means based on the data in our original sample. \n\n\n#### Solution to Question 8b\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# calculate difference in sample means\nobs.diff <- ??\nobs.diff  # print observed difference to screen\n```\n:::\n\n  \n  \n<br>  \n<br>  \n\n\n### Question 8c\n\n---\n\nBased on your answer to [Question 8b], given an estimate for the difference in the mean birth weights of all children born to a non-smoking parent compared to the mean birth weight of all children born to a parent that did smoke while pregnant. *Include units in your answer.*\n\n#### Solution to Question 8c\n\n---\n\n\n<br>  \n<br>  \n<br>  \n\n### Question 8d\n\n---\n\nBased on your estimate in [Question 8c], do you believe there is a difference in the mean birth weight of all babies whose parent smoked while pregnant compared to the mean birth weight of all babies whose parent did not smoke while pregnant?\n\n#### Solution to Question 8d\n\n<br>  \n<br>  \n<br>  \n\n\n## Accounting for Uncertainty in Sampling\n\n---\n\nIn the case of comparing samples, we do need to be mindful of the randomness involved in the sampling process. If we pick another sample of 189 babies and compare the difference in sample means, we will likely get another value for the difference in sample means. How can we determine whether the difference in sample means is larger than the variability we might expect due to sampling?\n\n# Bootstrapping Two Independent Samples\n\n---\n\n\n::: {.cell}\n\n:::\n\n\n\nGiven independent samples of sizes $m$ and $n$ from two independent populations:\n\n1.  Draw a resample of size $m$ *with replacement* from the first sample.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm.non <- length(non$bwt)  # m, size of sample 1\ntemp.non <- sample(non$bwt, size = m.non, replace = TRUE)\n```\n:::\n\n\n2.  Draw a resample of size $n$ *with replacement* from the second sample.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn.smoker <- length(smoker$bwt)  # n, size of sample 2\ntemp.smoker <- sample(smoker$bwt, size = n.smoker, replace = TRUE)\n```\n:::\n\n\n3.  Compute a statistic that compares the two groups such as a difference or ratio of two statistics (means, proportions, etc.)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiff.resample <- mean(temp.non) - mean(temp.smoker)\ndiff.resample\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 209.3382\n```\n:::\n:::\n\n\n4.   Repeat this process by picking two new resamples (one from each original sample) and compute difference in sample means.\n5. Construct a bootstrap distribution of the comparison statistics (such as a difference of means).\n\n\n## Question 9\n\n---\n\nFollow the steps below to generate a bootstrap distribution for the difference in sample means and obtain a 95% bootstrap percentile confidence interval for the difference in population means.\n\n\n### Question 9a\n\n---\n\nComplete the code cell below to construct a bootstrap distribution for the difference in the sample mean birth weights of of babies born to non-smokers compared to smokers.\n\n\n#### Solution to Question 9a\n\n---\n\nReplace all six `??` in the code cell below with appropriate code. Then run the completed code to generate a bootstrap distribution and mark the observed sample proportion (in red) and the mean of the bootstrap distribution (in blue) with vertical lines.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nN <- 10^5  # Number of bootstrap samples\nboot.diff.mean <- numeric(N)  # create vector to store bootstrap proportions\n\n# for loop that creates bootstrap dist\nfor (i in 1:N)\n{\n  x.non <- sample(??, size = ??, replace = ??)  # pick a bootstrap resample\n  x.smoker <- sample(??, size = ??, replace = ??)  # pick a bootstrap resample\n  boot.diff.mean[i] <- ??  # compute difference in sample means\n}\n\n# plot bootstrap distribution\nhist(boot.diff.mean,  \n     breaks=20, \n     xlab = \"x.bar.non - x.bar.smoker (in grams)\",\n     main = \"Bootstrap Distribution for Difference in Means\")\n\n# red line at the observed  difference in sample means\nabline(v = ??, col = \"firebrick2\", lwd = 2, lty = 1)\n\n# blue line at the center of bootstrap dist\nabline(v = ??, col = \"blue\", lwd = 2, lty = 2)\n```\n:::\n\n\n### Question 9b\n\n--- \n\nComplete the code cell below to give a 95% bootstrap percentile confidence interval to estimate the difference in the mean birth weight of all babies born to non-smokers compared the to mean birth of all babies born to smokers.\n\n\n\n#### Solution to Question 9b\n\n---\n\n\n**Based on the output below, a 95% bootstrap percentile confidence interval is from ?? to ??.**\n\n<br>  \n<br>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# find cutoffs for 95% bootstrap CI\nlower.bwt.95 <- quantile(??, probs = ??)  # find lower cutoff\nupper.bwt.95 <- quantile(??, probs = ??)  # find upper cutoff\n\n# print to screen\nlower.bwt.95\nupper.bwt.95\n```\n:::\n\n\n\n### Question 9c\n\n--- \n\nInterpret the practical meaning of your interval estimate in [Question 9b].\nDo you think it is plausible to conclude smoking does have an effect on the weight of a newborn? Explain why or why not.\n\n#### Solution to Question 9c\n\n---\n\n<br>  \n<br>  \n<br>  \n\n\n---\n\n![Creative Commons License](https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png) <nbsp>\n\n*Statistical Methods: Exploring the Uncertain* by [Adam Spiegler](https://github.com/CU-Denver-MathStats-OER/Statistical-Theory) is licensed under a [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-nc-sa/4.0/).\n\n",
    "supporting": [
      "17-Bootstrap-Confidence-Int_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}