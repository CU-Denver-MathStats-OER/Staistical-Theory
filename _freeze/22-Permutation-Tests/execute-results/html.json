{
  "hash": "db2512d1b61254b37197e727636ea3b2",
  "result": {
    "markdown": "---\ntitle: '6.2: Permutation Tests'\n#author: 'Adam Spiegler, University of Colorado Denver'\nexecute:\n  eval: false\noutput:\n  html_document:\n#    toc: yes\n#    toc_depth: 1\n#    theme: cerulean\n#jupyter:\n#  kernelspec:\n#    display_name: R\n#    language: R\n#    name: ir\n#output:\n#    ipynbdocument::ipynb_document\n---\n\n\n\n[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://githubtocolab.com/CU-Denver-MathStats-OER/Statistical-Theory/blob/main/Chap6/22-Permutation-Tests.ipynb){target=\"_blank\"} &nbsp;\n\n\n![Credit: Torsten MÃ¼tze, [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0), via Wikimedia Commons](https://upload.wikimedia.org/wikipedia/commons/b/b3/Permutation_generation_algorithms.svg){fig-align=\"left\" width=55% fig-alt=\"Permutation Illustration\"}\n\n# A Summary of Hypothesis Testing\n\n---\n\nIn the section [Introduction to Hypothesis Tests](21-Intro-Hypothesis-Tests.qmd), we walked through the process of performing a statistical hypothesis test:\n\n1. State the <span style=\"color:dodgerblue\">**null and alternative hypotheses**</span> in terms of population parameter(s).\n2. Compute <span style=\"color:dodgerblue\">**test statistic(s)**</span> from random sample(s). \n3. Calculate the <span style=\"color:dodgerblue\">**p-value**</span> to help assess which claim is more likely to be true.\n4. What <span style=\"color:dodgerblue\">**conclusions**</span> (if any) can we make about the two competing claims?\n\nSee [Introduction to Hypothesis Tests](21-Intro-Hypothesis-Tests.qmd) for a refresher on Steps 1 and 2. We also informally explored the concept of [statistical significance](21-Intro-Hypothesis-Tests.qmd#sec-informal-p). Today, we focus on Step 3 and discuss a resampling method, called a <span style=\"color:dodgerblue\">**permutation test**</span>, that we can use to calculate p-values to assess significance.\n\n## The Null Distribution and p-values\n\n---\n\nRecall the logic of hypothesis test. We want to assess which of two competing claims, the null hypothesis $H_0$ or the alternative hypothesis $H_a$, are more likely to be true. We assume $H_0$ is true and consider whether the sample data supports or refutes the null claim.  \n\n- The <span style=\"color:dodgerblue\">**null distribution**</span> is the distribution of the test statistic **if the null hypothesis is true**. We use the null distribution to calculate the p-value.\n- The <span style=\"color:dodgerblue\">**p-value**</span> is the **probability that we would get a random sample** with a test statistic as or more extreme as the observed test statistic **if the null hypothesis were true**.\n\n$${\\large {\\color{dodgerblue}{p\\mbox{-value} = P( \\mbox{test statistic as or more extreme than observed} \\ | \\ H_0 \\mbox{ is true} )}}}.$$\n\n-   The **smaller the $p$-value**, the **less likely the sample** is assuming $H_0$ is true.\n  - There is evidence that **contradicts $H_0$ and supports $H_a$**.\n  - The **smaller the $p$-value**, the **more statistically significant** the result.\n\n\n\n# Case Study: The Unscrupulous Diner's Dilemma\n\n---\n\nWe previously considered the [unscrupulous diner's dilemma](21-Intro-Hypothesis-Tests.qmd#sec-diner)^[Gneezy, U., E. Haruvy, and H. Yafe (2004), [\"The Inefficiency of Splitting the Bill\"](https://rady.ucsd.edu/_files/faculty-research/uri-gneezy/splitting-bill.pdf){target=\"_blank\"}, *The Economic Journal* 114.].\n\n\n> The unscrupulous diner's dilemma is a problem faced frequently in social settings. When a group of diners jointly enjoys a meal at a restaurant, often an unspoken agreement exists to divide the check equally. A selfish diner could thereby enjoy exceptional dinners at bargain prices. This dilemma typifies a class of serious social problems^[Glance, N., and B. Huberman, [\"The Dynamics of Social Dilemmas\"](http://www.uvm.edu/~pdodds/files/papers/others/1994/glance1994a.pdf){target=\"_blank\"}, *Scientific American*] from environmental protection and resource conservation to eliciting charity donations and slowing arms races.\n\n\nResearchers wanted to test whether people order more food and beverages when they know the bill is going to be split evenly compared to when each person only pays for what they ordered.\n\n\n## Step 1: State the Hypotheses\n\n---\n\n-   $H_0$: There is no difference in how much people order regardless of how the bill is split. ${\\color{dodgerblue}{\\mu_{\\rm even} - \\mu_{\\rm control}=0}}.$\n-   $H_a$: People order more when the bill is split evenly as opposed to when each person pays for what they order. ${\\color{dodgerblue}{\\mu_{\\rm even} - \\mu_{\\rm control}>0}}.$\n\n\n## Step 2: Collect Sample Data and Define a Test Statistic\n\n---\n\n8 people volunteered to take part in the study.\n\n- 4 people were randomly assigned to sit at a table where they were told the bill would be evenly split between the 4 people.\n- 4 people were randomly assigned to sit at a table where they were told each person would pay only for what they order themselves.\n\nThe results of the study are given in the tables below:\n\n| Even Split Group                         | Pay for what you order (control) Group    |\n|------------------------------------|------------------------------------|\n| $\\$15.00$, $\\$8.00$, $\\$8.75$, $\\$13.17$ | $\\$8.50$ , $\\$7.90$ , $\\$10.85$, $\\$7.43$ |\n| $\\bar{x}_{\\rm even} = \\$11.23$           | $\\bar{x}_{\\rm control} = \\$8.67$          |\n\n-   **We can use the difference in the two sample means as a test statistic:**\n\n$${\\color{dodgerblue}{T= \\bar{x}_{\\rm even} - \\bar{x}_{\\rm control} = 2.56}}$$\n\n## Step 3: How Extreme Is the Observed Difference?\n\n---\n\nThe p-value is the probability of getting a difference in sample means between the even-split and self-pay groups as or more extreme than the observed test statistic, $\\bar{x}_{\\rm even} - \\bar{x}_{\\rm control} = 2.56$. In this case (one-tailed test), more extreme implies a difference that is even bigger than $\\$2.56$.\n\n$${\\color{dodgerblue}{\\mbox{p-value} = P(\\bar{x}_{\\rm even} - \\bar{x}_{\\rm control} \\geq 2.56 \\ | \\ H_0 \\mbox{ is true} )}}$$\n\nIf $H_0$ is true, then $\\mu_{\\rm even} - \\mu_{\\rm control} =0$. Under this assumption, the center of the sampling distribution for the difference in sample means would be $0$. However, we do not know how much variability there is due to the sampling. **Is a difference in sample means equal to $\\$2.56$ a \"big\" difference, or is the difference within the margins we would expect due to the uncertainty of sampling?**\n\n> How can we calculate the p-value if we do not know the underlying probability distribution for the test statistic $T = \\mu_{\\rm{even}} - \\mu_{\\rm{control}}$ if $H_0$ is true?\n\n\n## Question 1\n\n---\n\nIf people order the same amount of food no matter how the bill is split (assuming $H_0$ is true), we assume each person would order the same amount of food regardless of the table they were seated at. **Splitting by groups based on how the bill is paid is no different than if the eight values were just randomly divided into two groups of four people.** If each person would have ordered the same regardless of which table they were seated at, then another possible sample could have been:\n\n| Even Split Group                   | Pay for what you order (control) Group |\n|------------------------------------|----------------------------------------|\n| $\\mathbf{\\color{dodgerblue}{\\$7.43}}$ , $\\$8.00$, $\\$8.75$, $\\$13.17$ | $\\$8.50$ , $\\$7.90$ , $\\$10.85$, $\\mathbf{\\color{dodgerblue}{\\$15.00}}$ |\n\n### Question 1a\n\n---\n\nWhat would be the test statistic for the two samples above?\n\n#### Solution to Question 1a\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# find the test statistic for another possible sample\n```\n:::\n\n\n\n<br>  \n<br>  \n\n### Question 1b\n\n---\n\nHow many different ways can we divide the eight participants into two groups of four?\n\n#### Solution to Question 1b\n\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# how many possible ways can we create two groups of 4\n```\n:::\n\n\n\n<br>  \n<br>  \n\n# Two-Sample Permutation Tests {#sec-perm-test}\n\n---\n\nTo perform a <span style=\"color:dodgerblue\">**two-sample permutation test**</span> on data collected from two samples size $m$ and $n$:\n\n1.  Pool the $m+n$ values together.\n2.  Draw a <span style=\"color:dodgerblue\">**permutation resample**</span> of size $m$ (size of first sample), **without replacement**.\n3.  Use the remaining $n$ (size of second sample) observations for the other sample.\n4.  Calculate the difference in means or another statistic to compares samples.\n5.  Repeat the resampling process many times and construct the distribution of test statistics.\n\n<span style=\"color:dodgerblue\">**The p-value is the proportion of times the randomized statistics are as or more extreme than the observed difference.**</span>\n\n![Permutation resamples of the Unscrupulous Diners Dilemma Data](https://raw.githubusercontent.com/CU-Denver-MathStats-OER/Statistical-Theory/main/Images/22fig-meal-perm.png){width=\"90%\"}\n\n# Case Study: Melanoma Lesion Thickness\n\n---\n\n\n![Credit: Braga, Macedo, Pinto, et. al., [CC BY 4.0](https://creativecommons.org/licenses/by/4.0), via Wikimedia Commons](https://upload.wikimedia.org/wikipedia/commons/d/d0/Superficial_spreading_melanoma_in_situ_on_dermoscopy%2C_reflectance_confocal_microscopy_and_histopathology_2.jpg){fig-align=\"left\" width=55% fig-alt=\"Superficial spreading melanoma\"}\n\n\nSkin is the largest organ in the human body. In the United States, skin cancer is the most common cancer. Current estimates are that one in five Americans will develop skin cancer in their lifetime^[American Academy of Dermatology, [Skin Cancer Stats](https://www.aad.org/media/stats-skin-cancer){target=\"_blank\"}.]. There are different types of skin cancers, and melanoma is one form of skin cancer that is particularly dangerous if not detected early. However, if a skin lesion is detected early, it can be surgically removed before it spreads, and a patient generally has good long-term outcomes.\n\nThe data set `melanoma` in the `boot` package contains measurements from a random sample of $205$ patients with malignant melanoma at the University Hospital of Odense in Denmark. Each patient had a skin lesion (or tumor) surgically removed and various attributes of the patient and tumors are recorded. Run the code cell below to load the `boot` package and summarize the variables in the `melanoma` data set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(boot)\nsummary(melanoma)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      time          status          sex              age             year     \n Min.   :  10   Min.   :1.00   Min.   :0.0000   Min.   : 4.00   Min.   :1962  \n 1st Qu.:1525   1st Qu.:1.00   1st Qu.:0.0000   1st Qu.:42.00   1st Qu.:1968  \n Median :2005   Median :2.00   Median :0.0000   Median :54.00   Median :1970  \n Mean   :2153   Mean   :1.79   Mean   :0.3854   Mean   :52.46   Mean   :1970  \n 3rd Qu.:3042   3rd Qu.:2.00   3rd Qu.:1.0000   3rd Qu.:65.00   3rd Qu.:1972  \n Max.   :5565   Max.   :3.00   Max.   :1.0000   Max.   :95.00   Max.   :1977  \n   thickness         ulcer      \n Min.   : 0.10   Min.   :0.000  \n 1st Qu.: 0.97   1st Qu.:0.000  \n Median : 1.94   Median :0.000  \n Mean   : 2.92   Mean   :0.439  \n 3rd Qu.: 3.56   3rd Qu.:1.000  \n Max.   :17.42   Max.   :1.000  \n```\n:::\n:::\n\n\n\n\n## Question 2\n\n---\n\nBased on the `summary(melanoma)` output, give a possible statistical question that could be analyzed using a hypothesis test. Which variable(s) in the `melanoma` data set would be involved in your analysis?\n\n::: {.callout-tip}\nRun `?melanoma` to access the help documentation and learn more about the data.\n:::\n\n### Solution to Question 2\n\n---\n\n<br>  \n<br>  \n<br>  \n\n## Question 3\n\n---\n\nWhich variables in `melanoma` are categorical? Are those variables being stored as categorical variables? If so, explain how you can tell. If not, in the code cell below, convert the categorical variables to a `factor`.\n\n\n### Solution to Question 3\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# if needed, convert each categorical variable to a factor\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n<br>  \n<br>  \n\n\n## Creating a Pooled Sample\n\n---\n\nSuppose we want to answer the following question: *\"Is the mean tumor thickness greater for all people with fatal melanoma compared to the mean tumor thickness for all people that survive melanoma?\"* The two variables of interest are `status` and `thickness`.\n\n- `status`: The patients status at the end of the study. `1` indicates that they had died from melanoma, `2` indicates that they were still alive and `3` indicates that they had died from causes unrelated to their melanoma.\n- `thickness`: Tumor thickness in millimeters (mm).\n\nFor our study, we are comparing two independent populations:\n\n- People that have a melanoma tumor removed and survive. This is `status` group `2`.\n- People that have a melanoma tumor removed and died from melanoma. This is `status` group `1`.\n- The people in `status` group `3` we exclude from this analysis.\n\n\n## Question 4\n\n---\n\nAnswer the questions below to state our hypotheses, organize our data, and calculate a test statistic to help determine whether the mean tumor thickness is greater for all people with fatal melanoma compared to the mean tumor thickness for all people that survive melanoma.\n\n\n### Question 4a\n\n---\n\nCreate side-by-side box plots to display the distribution of tumor thickness for each of the three `status` groups `1` (died from melanoma), `2` (survived), and `3` (died from other causes).\n\n\n#### Solution to Question 4a\n\n---\n\nFill in the `boxplot()` command to answer the question.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(??)\n```\n:::\n\n\n<br>  \n<br>  \n\n\n\n### Question 4b\n\n---\n\nThe function `tapply(data, index, function)` has three inputs:\n\n-   The `data` is the data you want to summarize.\n-   The `index` is a categorical feature that will split the data into two or more different classes or factors.\n-   The `function` is some function that you want to apply to the data.\n\nInterpret the output from the code cell below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# run code and interpret output below\ntapply(melanoma$thickness, melanoma$status, length)  # nothing to edit\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  1   2   3 \n 57 134  14 \n```\n:::\n:::\n\n\n#### Solution to Question 4b\n\n---\n\n\n<br>  \n<br>  \n<br>  \n\n\n\n### Question 4c\n\n---\n\nWe would like to use the data in `melanoma` to test the if the mean tumor thickness is greater for all people with fatal melanoma compared to the mean tumor thickness for all people that survive melanoma. State the corresponding null and alternative hypotheses for this test. Be sure to state each hypothesis both in words and using mathematical notation.\n\n\n#### Solution to Question 4c\n\n---\n\n- $H_0$: \n\n- $H_a$: \n\n<br>  \n<br>  \n\n### Question 4d\n\n---\n\nUsing the code cell below, subset the `melanoma` data to create three different vectors:\n\n1. The vector `died` is the `thickness` values for `status` group 1.\n2. The vector `survived` is the `thickness` values for `status` group 2.\n3. The vector `pooled` is the `thickness` values for  both `status` groups 1 and 2 (excluding group 3).\n\n::: {.callout-note}\nThe logical operator `==` means \"is equal to\" while the logical operator `!=` means \"is not equal to\".\n:::\n\n::: {.callout-note}\nThe option `drop = TRUE` means the output will be a vector of numerical values as opposed to a data frame that has a variable with the name `thickness`. For example, if we want to calculate the sample mean for the `pooled` data:\n\n- Since the data is stored as a vector, we use `mean(pooled)`. There are no headers in vectors.\n- If the data is stored as a data frame, we do need to use headers and have `mean(pooled$thickness)`.\n\nThe output of the code cell below are vectors, so we do not use the `$var_name` convention when referring to the sample data which helps simplify the code a little.\n:::\n\n\n#### Solution to Question 4d\n\n---\n\nReplace each of the 9 `??` with an appropriate value or variable name.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndied <- subset(melanoma, select = ??, ?? == \"??\", drop = TRUE)\nsurvived <- subset(melanoma, select = ??, ?? == \"??\", drop = TRUE)\npooled <- subset(melanoma, select = ??, ?? != \"??\", drop = TRUE)\n```\n:::\n\n\n<br>  \n<br>  \n\n\n\n::: {.cell}\n\n:::\n\n\n\n### Question 4e\n\n---\n\n\nUsing the vectors `died`, `survived`, and `pooled` from [Question 4d], calculate the sample size and the sample mean for each of the samples `died`, `survived`, and `pooled`. \n\n\n#### Solution to Question 4e\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn.died <- ??  # size of sample of melanoma deaths\nn.survived <- ??  # size of sample of survivors\nn.pooled <- ??  # size of both samples pooled together\nxbar.died <- ??  # mean thickness of sample that died\nxbar.survived <- ??  # mean thickness of sample that survived\nxbar.pooled <- ??  # mean thickness of pooled sample\n\n# print each result to screen\nn.died \nn.survived \nn.pooled \nxbar.died \nxbar.survived \nxbar.pooled   \n```\n:::\n\n\n<br>  \n<br>  \n\n### Question 4f\n\n---\n\nBased on the output in [Question 4e], calculate, store, and print the test statistic for this test to the screen.\n\n#### Solution to Question 4f\n\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest.stat <- ??  # compute test statistic\ntest.stat  # print test statistic to screen\n```\n:::\n\n\n<br>  \n<br>  \n\n\n\n# Constructing a Permutation Distribution\n\n---\n\n## Step 1: Create a Vector of Pooled Data\n\n---\n\nSee the code used to create `pooled` in [Question 4d].\n\n\n## Step 2: Create Resamples for Each Treatment Group\n\n---\n\nFor this step, it is important to note the size of each original sample. From [Question 4e] we know\n\n- The sample `died` consists of 57 observations.\n- The sample `survived` consists of 134 observations.\n- The `pooled` sample consists of $57 + 134= 191$ observations.\n\n#### Create an Index Vector\n\n---\n\nWe first create a vector called `index` that selects (without replacement) 57 random integers out of the integers $1, 2, \\ldots , 191$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(3021)  # fix the randomization seeding\nindex <- sample(191, size = 57, replace = FALSE)  # these are the 57 observations chosen for resample 1\n```\n:::\n\n\nThe command `head(index)` shows the first 6 values in the vector `index`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(index)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  55 164  88 189 171  68\n```\n:::\n:::\n\n\nThe first `index` value 55 means observation 55 from the `pooled` vector is the first thickness value randomly assigned to the `died` sample. From the code cell below, we see the 55th observation in `pooled` is a thickness of $0.81$ mm.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npooled[55]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.81\n```\n:::\n:::\n\n\nThe next `index` value 164 means observation 164 from the `pooled` vector is the second thickness value randomly assigned to the `died` sample. From the code cell below, we see the 164th observation in `pooled` is a thickness of $0.65$ mm.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npooled[164]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.65\n```\n:::\n:::\n\n\n#### Use `index` to Select Resample of Group 1\n\n---\n\nThe `index` vector is a vector of integers that tells us which values in `pooled` are randomly assigned to the `died` resample. However, `index` does not contain the corresponding thicknesses of the selected observations. The vector `pooled[index]` will contain the tumor thicknesses for all 57 randomly selected observations picked in `index`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndied.resample <- pooled[index]\n```\n:::\n\n\n\n#### Use `-index` to Select the Remaining Values for Resample Group 2\n\n---\n\n- The vector `index` consists of 57 randomly selected integers out of the integers $1, 2, \\ldots , 191$.\n- The vector `-index` contains the remaining 134 integers that were not selected for `index`.\n- The vector `pooled[-index]` will contain thicknesses for the remaining 134 observations in resample group 2.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvived.resample <- pooled[-index]\n```\n:::\n\n\n\n## Step 3: Calculate the Test Statistic for the Resamples\n\n---\n\nCalculate the difference in the sample means between the two resamples.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nperm.stat <- mean(died.resample) - mean(survived.resample)\nperm.stat\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.1487287\n```\n:::\n:::\n\n\n## Step 4: Repeat this Many Times to Construct a Permutation Distribution\n\n---\n\n- In practice, it takes a lot of time and energy (and money) to generate all possible resamples (without any duplicate resamples). \n  - Instead we'll generate a lot of resamples rather than all possible resamples.\n- We'll use $N=10^5-1=99,\\!999$ as the default number of resamples. <span style=\"color:tomato\">**Why use 99,999 resamples?**</span>\n  - We may not generate the original sample as one of the resamples.\n  - We want to be sure that we do include the original sample when we calculate the p-value.\n  - We will add the original sample back in with the $99,\\!999$ resamples giving $100,\\!000$ samples.\n-   The resulting distribution of test statistics of the permutation resamples is called a <span style=\"color:dodgerblue\">**permutation distribution**</span>.\n  - We use the permutation distribution as an estimate for the null distribution to compute the p-value.\n\n\n\n## Question 5\n\n---\n\nComplete the first code cell below to create a permutation distribution for the difference in sample mean tumor thickness. Be sure you have already created the vector `pooled` in [Question 4d] and stored `test.stat` in [Question 4f].\n\nAfter generating a permutation distribution, run the second code cell below to create a histogram to display the distribution of resample statistics along with a red vertical line through the observed test statistic. There is nothing to edit in the second code cell.\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n### Solution to Question 5\n\n---\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##########################################\n# save all 99,999 permutation resample \n# statistics to the vector perm.stat\n##########################################\nN <- 10^5 - 1\nperm.stat <- numeric(N)\n\nfor (i in 1:N)\n{\n  index <- sample(??, size = ??, replace = ??)  # create index vector\n  x.died <- ??  # use index to select died resample\n  x.survived <- ??  # the rest of the values go to survived resample\n  perm.stat[i] <- ??  # calc difference in sample means\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n##################################################\n# plot permutation distribution as a histogram\n# mark observed test stat with red vertical line\n##################################################\nhist(perm.stat, xlab = \"xbar.died - xbar.survived\",\n     main = \"Permutation Distribution\")\nabline(v = test.stat, col = \"red\")\n```\n:::\n\n\n# p-values with Permutation Distributions\n\n---\n\n\nWe use the permutation distribution as an estimate for the null distribution. The p-value is the proportion of all resampled test statistics that are as or more extreme than the observed test statistic. We can use a logical test to help compute this proportion.\n\n## Question 6\n\n---\n\nHow likely is it to get resamples with a difference in means as or more extreme than the observed test statistic? Explain what the code below is doing in practical terms.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np.value <- sum(perm.stat >= test.stat)/N\np.value\n```\n:::\n\n\n### Solution to Question 6\n\n---\n\nInterpret the code cell above.\n\n<br>  \n<br>  \n<br>  \n\n\n## Question 7\n\n---\n\nThe calculation from [Question 6] used the $N=10^5-1=99,\\!999$ permutation resamples, but recall we want to be sure to include the original, observed sample when computing the p-value. Explain how the code cell below accomplishes this goal.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np.value <- (sum(perm.stat >= test.stat) + 1) / (N + 1)\np.value\n```\n:::\n\n\n### Solution to Question 7\n\n---\n\n\n<br>  \n<br>  \n<br>  \n\n\n\n\n## Question 8\n\n---\n\nInterpret the practical meaning of the p-value from [Question 7] to a person who is not very familiar with statistics.\n\n### Solution to Question 8\n\n---\n\n<br>  \n<br>  \n<br>  \n\n\n# Permutation Test for a Difference in Variances\n\n---\n\n## Question 9\n\n---\n\nUlceration is a breakdown of the skin over the melanoma tumor. Using the data set `melanoma` from the `boot` package, perform a permutation test to see if the variance of the tumor thickness for ulcerated tumors is different from the variance of the tumor thickness for non-ulcerated tumors.\n\n::: {.callout-tip}\nThe variable `ulcer` indicates whether the removed tumor was ulcerated (`ulcer` group `1`) or not ulcerated (`ulcer` group `0`).\n:::\n\n### Question 9a\n\n---\n\nWrite out the null and alternative hypotheses using appropriate notation.\n\n#### Solution to Question 9a\n\n---\n\n-   $H_0$:\n\n-   $H_a$:\n\n<br>  \n<br>  \n<br>  \n\n\n### Question 9b\n\n---\n\nWhat can we use as the test statistic? What is the value of the observed test statistic?\n\n#### Solution to Question 9b\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest.stat2 <- ??  # compute observed test statistic\ntest.stat2  # print output to screen\n```\n:::\n\n\n<br>  \n<br>  \n\n### Question 9c\n\n---\n\nCreate a permutation distribution for the difference in sample variances.\n\n#### Solution to Question 9c\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# nothing to edit in this cell\npooled2 <- melanoma$thickness  # create pooled vector of all tumor thicknesses\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save resamples to vector called result\nN <- 10^5 - 1\nresult <- numeric(N)\n\n# Create permutation distribution\nfor (i in 1:N)\n{\n  index <- sample(??, size = ??, replace = ??)\n  result[i] <- ??\n}\n\n# Display permutation distribution and observed sample diff\nhist(result, xlab = \"diff in sample variances\",\n     main = \"Permutation Distribution\")\nabline(v = c(-test.stat2, test.stat2), col = c(\"blue\", \"red\"))\n```\n:::\n\n\n<br>  \n<br>  \n\n### Question 9d\n\n---\n\nCalculate the p-value of the observed test statistic and interpret its meaning in practical terms.\n\n#### Solution to Question 9d\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# compute the p-value\n```\n:::\n\n\n<br>  \n<br>  \n<br>  \n\n\n# Permutation Test for a Difference in Proportions\n\n---\n\n\n## Question 10\n\n---\n\nIs the proportion of females with ulcerated tumors less than the proportion of males with ulcerated tumors?\n\n### Question 10a\n\n---\n\nWrite out the null and alternative hypotheses using appropriate notation.\n\n#### Solution to Question 10a\n\n---\n\n-   $H_0$:\n\n-   $H_a$:\n\n<br>  \n<br>  \n<br>  \n\n\n### Question 10b\n\n---\n\nWhat can we use as the test statistic? What is the value of the observed test statistic?\n\n\n#### Solution to Question 10b\n\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# original ulceration data for female sample\nfemale <- subset(melanoma, select = \"ulcer\", sex == \"0\", drop = TRUE)\n\n# original ulceration data for male sample\nmale <- subset(melanoma, select = \"ulcer\", sex == \"1\", drop = TRUE)\n\n# original ulceration data for both samples pooled together\npooled.sex <- melanoma$ulcer \n\n\n# enter a formula to compute the test statistic\ntest.diff.prop <- ??\n```\n:::\n\n\n<br>  \n<br>  \n\n### Question 10c\n\n---\n\nCreate a permutation distribution for the difference in sample proportions.\n\n#### Solution to Question 10c\n\n---\n\nComplete the code cell below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nN <- 10^5 - 1\nresult.prop <- numeric(N)\n\nfor (i in 1:N)\n{\n  index <- sample(??, size = ??, replace = ??)\n  result.prop[i] <- ??\n}\n\nhist(result.prop, xlab = \"phat1-phat2\",\n     main = \"Permutation Distribution\")\nabline(v = test.diff.prop, col = \"red\")\n```\n:::\n\n\n<br>  \n<br>  \n\n### Question 10d\n\n---\n\nCalculate the p-value of the observed test statistic and interpret its meaning in practical terms.\n\n#### Solution to Question 10d\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# compute the p-value\n```\n:::\n\n\n<br>  \n<br>  \n<br>  \n\n\n# Permutation Test for Matched Pairs\n\n---\n\n## Question 11\n\n---\n\nIn this example, we use data collected from a matched pair designed study to determine whether smoking during pregnancy is associated with lower birth weight. In our study, we solicit volunteers that have already given birth to two babies. During one of the pregnancies, the parent smoked. During the other pregnancy, they did not smoke. Below is hypothetical data from such a study. A sample of $n=10$ people volunteer to share their data with the researchers from which we have 10 different pairs of birth weights (in grams) summarized in the table below.\n\n\n|             | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   |\n|-------------|------|------|------|------|------|------|------|------|------|------|\n| No Smoking  | 2750 | 2920 | 3860 | 3402 | 2282 | 3790 | 3586 | 3487 | 2920 | 2835 |\n| Smoked      | 1790 | 2381 | 3940 | 3317 | 2125 | 2665 | 3572 | 3156 | 2721 | 2225 |\n\n\n\n### Question 11a\n\n---\n\nResearchers are testing to see if the birth weight of babies born to a parent that smoked while pregnant is less, on average, compared to a babies whose parent did not smoke while they were pregnant. Write out the null and alternative hypotheses using appropriate notation.\n\n\n\n#### Solution to Question 11a\n\n---\n\n-   $H_0$:\n\n-   $H_a$:\n\n<br>  \n<br>  \n<br>  \n\n\n\n### Question 11b\n\n---\n\nWhat can we use as the test statistic? What is the value of the observed test statistic?\n\n#### Solution to Question 11b\n\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data from study\nno <- c(2750, 2920, 3860, 3402, 2282, \n        3790, 3586, 3487, 2920, 2835)  # non-smoking births weights\n\nsmoker <- c(1790, 2381, 3940, 3317, 2125, \n            2665, 3572, 3156, 2721, 2225)  # matching smoking birth weight\n\ndiff <- no - smoker  # differences between matched pairs\n\n# Calculate the observed test statistic\ntest.match.diff <- ??\n```\n:::\n\n\n<br>  \n<br>  \n\n### Question 11c\n\n---\n\nWhen we construct a permutation distribution for the sample mean difference between matched pairs, we want to be sure the resampling we use **preserves each pairing**.\n\n- We do not randomize how the pairs are formed.\n- Each pair of values should remain paired after resampling.\n- Instead, we randomly assign values in each pair to the smoker and non-smoker positions.\n\nFor example, our original sample of matched pair differences is\n\n|             | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   |\n|-------------|------|------|------|------|------|------|------|------|------|------|\n| No Smoking  | 2750 | 2920 | 3860 | 3402 | 2282 | 3790 | 3586 | 3487 | 2920 | 2835 |\n| Smoked      | 1790 | 2381 | 3940 | 3317 | 2125 | 2665 | 3572 | 3156 | 2721 | 2225 |\n| Difference  | 960  | 539  | -80  | 85   | 157  | 1125 | 14   | 331  | 199  | 610  |\n\nOne possible resample is given below.\n\n|             | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   |\n|-------------|------|------|------|------|------|------|------|------|------|------|\n| No Smoking Resample  | <span style=\"color:tomato\">1790</span> | 2920 | 3860 | <span style=\"color:tomato\">3317</span> | 2282 | <span style=\"color:tomato\">2665</span> | 3586 | 3487 | 2920 | 2835 |\n| Smoked Resample      | <span style=\"color:tomato\">2750</span> | 2381 | 3940 | <span style=\"color:tomato\">3402</span> | 2125 | <span style=\"color:tomato\">3790</span> | 3572 | 3156 | 2721 | 2225 |\n| Difference Resample | <span style=\"color:tomato\">-960</span>  | 539  | -80  | <span style=\"color:tomato\">-85</span>   | 157  | <span style=\"color:tomato\">-1125</span> | 14   | 331  | 199  | 610  |\n\n\nTo create a permutation distribution for the sample mean difference between matched pairs, <span style=\"color:dodgerblue\">**we randomly choose a sign (positive or negative) for each observed matched-pair difference.**</span> Complete the code cell below to generate a permutation distribution for the sample mean difference between matched pairs.\n\n\n\n#### Solution to Question 11c\n\n---\n\nComplete and run the code cell below to create a permutation distribution.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nN <- 10^5-1\nperm.match <-numeric(N)\n\n# for each pair, randomly assign the difference to be positive or negative.\n# then calculate the new mean of the paired differences\nfor (i in 1:N)\n{\n  sign <-sample(c(-1,1), size = ??, replace = ??) # random choose a sign -1 or 1\n  diff.resample <- sign * diff\n  perm.match[i] <- ??\n}\n```\n:::\n\n\nThere is nothing to edit in the code cell below. Run the code cell below to plot the permutation distribution and test statistic. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create a histogram of the permutation distribution\n# and add a vertical line at the observed test statistic\nhist(perm.match,  xlab = \"xbar-diff\",\n     main = \"Permutation Distribution\")\nabline(v = test.match.diff, col =\"red\")\n```\n:::\n\n\n<br>  \n<br>  \n\n### Question 11d\n\n---\n\nCalculate the p-value of the observed test statistic and interpret its meaning in practical terms.\n\n#### Solution to Question 11d\n\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# compute the p-value\n```\n:::\n\n\n<br>  \n<br>  \n<br>  \n\n\n\n## Question 12\n\n---\n\n\n**Is there a difference in the price of groceries sold by Target and Walmart?** The data set `Groceries` in the `resampledata` package contains a sample of $n=24$ different grocery items and a pair prices (price at Target and price at Walmart) advertised on their respective websites on a specific day.\n\n- First we load the `resampledata` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(resampledata)  # load resampledata package\n```\n:::\n\n\n- Then we print the first six rows of the `Groceries` data.\n- Notice this is matched pairs data!\n\n::: {.callout-warning}\nIf you received an error when running the code cell below, it is possible you do not have the `resampledata` package installed. From the R console, run the command `install.packages(\"resampledata\")` to first install the `resampledata` packaged.  Run the `library(resampledata)` command in the code cell above again. Then try running the code cell below again.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(Groceries)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                             Product    Size Target Walmart Units UnitType\n1            Kellogg NutriGrain Bars  8 bars   2.50    2.78     8     bars\n2 Quaker Oats Life Cereal  Original     18oz   3.19    6.01    18       oz\n3         General Mills Lucky Charms 11.50oz   3.19    2.98    11       oz\n4          Quaker Oats Old Fashioned    18oz   2.82    2.68    18       oz\n5               Nabisco Oreo Cookies  14.3oz   2.99    2.98    14       oz\n6                 Nabisco Chips Ahoy    13oz   2.64    1.98    13       oz\n```\n:::\n:::\n\n\n- Next, we save corresponding Target and Walmart prices to separate vectors `target` and `walmart`.\n- The first six values in each vector are printed to the screen.\n- Notice the ordering of the values in each vector is very important to preserve.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntarget <- Groceries$Target\nwalmart <- Groceries$Walmart\nhead(target)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.50 3.19 3.19 2.82 2.99 2.64\n```\n:::\n\n```{.r .cell-code}\nhead(walmart)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.78 6.01 2.98 2.68 2.98 1.98\n```\n:::\n:::\n\n\nUsing the sample data stored in `target` and `walmart`, answer the questions below to perform a permutation test.\n\n\na.  Set up hypotheses to test whether there a difference in the price of groceries sold by Target and Walmart?\n\nb.  What is the observed test statistic?\n\nc.  Create a permutation distribution for the sample mean difference between matched pairs.\n\nd.  Calculate the p-value.\n\ne.  Interpret the meaning of the p-value.\n\n### Solution to Question 12\n\n---\n\n<br>  \n<br>  \n<br>  \n\n\n---\n\n![Creative Commons License](https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png) <nbsp>\n\n*Statistical Methods: Exploring the Uncertain* by [Adam Spiegler](https://github.com/CU-Denver-MathStats-OER/Statistical-Theory) is licensed under a [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-nc-sa/4.0/).\n",
    "supporting": [
      "22-Permutation-Tests_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}