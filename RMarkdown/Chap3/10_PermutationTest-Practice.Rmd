---
output:
  html_document: default
---

# More Practice with Permutation Tests
### Mar 8, 2021

**Load required packages first**
```{r, message=FALSE}
library(resampledata)
```

## Permutation Test with Match-Pairs 
### Case Study: Olympic Swimsuit

**In the 2008 Olympics there was a lot of controversy over new swimsuits that possibly provided an unfair advantage to swimmers
which led to new international rules regarding swimsuit materials and coverage. Can a swimsuit really make a swimmer faster?**

5. **If researchers are testing to see whether the wetsuit makes people swim faster, set up hypotheses for this test.**

H~0~: The wetsuit does not make a difference in how fast people are able to swim.

H~a~: The wetsuit does help people swim faster.

6. **What is the observed test statistic?** 

```{r}
# Vectors containing the times of each swimmer. Ordering is critical
wetsuit <- c(1.57, 1.47, 1.42, 1.35, 1.22, 1.75, 1.64, 1.57, 1.56, 1.53, 1.49, 1.51)
none <- c(1.49, 1.37, 1.35, 1.27, 1.12, 1.64, 1.59, 1.52, 1.50, 1.45, 1.44, 1.41)

# Create a vector of the 12 paired differences
Diff <- wetsuit - none

# Calculate the observed test statistic, the mean of the paired differences
observed <-mean(Diff) 
observed
```

7. **Create a permutation distribution for the difference in sample means.**

```{r}
# Create a numeric vector size N to store the resampled paird differences
N <- 10^5-1
result <-numeric(N)

# For each pair, randomly assign the difference to be positive or negative.
# Then calculate the new mean of the paired differences
for (i in 1:N)
{
  Sign <-sample(c(-1,1), 12, replace=TRUE) # random pick -1 or 1, 12 different times (1, -1, 1,1, -1 ...)
  Diff2 <- Sign*Diff
  result[i] <- mean(Diff2)
}

# Create a histogram of the permutation distribution
# And add a vertical line at the observed test statistic
hist(result,  xlab = "xbar-diff",
     main = "Permutation Distribution")
abline(v = observed, col = "steelblue")
```

a. **Calculate the P-value.**

```{r}
pvalue <- (sum(result >= observed) + 1)/(N+1)
pvalue
```

b. **Interpret the meaning of the P-value.**

There is a `r pvalue*100` % chance of observing a sample difference of `r observed` if the wetsuit does not help people swim faster.

------

### Case Study: Comparing Prices at Target and Walmart

8. **(Exercise 3.15) Is there a difference in the price of groceries sold by Target and Walmart? The dataset <font color="green">Groceries</font> contains a sample of grocery items and their prices advertised on their respective websites on a specific day.**

a. **Set up hypotheses for this test.**

H~0~:

H~a~: 

b. **What is the observed test statistic?** 

c. **Create a permutation distribution for the difference in sample means.**

d. **Calculate the P-value.**

e. **Interpret the meaning of the P-value.**

-------

## Even More Practice
### Case Study: Do buried aquifiers have lower lead levels?

9. **The dataset <font color="green">MnGroundwater</font> contains data from the 895 randomly selected well samples throughout Minnnesota.**

+ Each observation (row) corresponds to a sample of well water.
+ The variable <font color="blue">Lead</font> gives the lead level in the sample in $\mu$g/L.
+ The variable <font color="blue">Aquifer.Group</font> describes which aquifer feeds the well water.
  + **Quaternary aquifers** are aquifers that were created by glaciers. 
  + **Buried quaternary aquifers** are below bedrock. These are indicated with the value <font color="red">*buried Quaternary*</font>. Note the use of upper and lowercase letters and the space between the two words.
  + **Surficial quaternary aquifers** lie on top of bedrock.These are indicated with the value <font color="red">*surficial Quaternary*</font>.

**Does well water from buried quaternary aquifiers have a lower lead level than water from surficial quaternary aquifers?**

a. **Set up hypotheses for this test.**

H~0~: 

H~a~: 

b. **What is the observed test statistic?** 

c. **Create a permutation distribution for the difference in sample means.**

d. **Calculate the P-value.**

e. **Interpret the meaning of the P-value.**
