---
title: "Bootstrap Distributions Part 2"
output: 
  pdf_document: 
    fig_height: 3
    fig_width: 4
---

# Bootstrap Distributions Part 2

**Load required packages first**
```{r, message=FALSE}
library(resampledata)
```

## Solution Last Class: Bangladesh Arsenic Case Study

Arsenic is a naturally occurring element in the groundwater in Bangladesh. Much of this water is used for drinking in rural areas,
so arsenic poisoning is a serious health issue. The dataset **Bangladesh** contains measurements on arsenic, chlorine, and cobalt levels (in parts per billion, ppb) present in each of 271 groundwater samples. 


a. Calculate the mean and standard deviation and size of the arsenic level of the sample.

```{r}
# Load and summarize the sample
arsenic <- Bangladesh$Arsenic
samp.mean <- mean(arsenic)
samp.mean
samp.sd <- sd(arsenic)
samp.sd
n.arsenic <- length(arsenic) # how many observations in arsenic
n.arsenic
```

b. Create a histogram to show the shape of the distribution of the sample data. How would you describe the shape?

```{r}
hist(arsenic)
# Optional code below creates a cool thing we have yet to encounter.
# We'll see how to interpret this plot shortly.
qqnorm(arsenic)
qqline(arsenic)
```

c. What are the center and spread (standard error) of the bootstrap resample?

```{r}
N <- 10^5 # Number of bootstrap samples
boot.dist <- numeric(N) #create vector to store bootstrap means

# Set up a for loop!

for (i in 1:N)
{
  x <- sample(arsenic, n.arsenic, replace = TRUE)
  boot.dist[i] <- mean(x)
}

mean(boot.dist) #Calculate center of bootstrap dist
sd(boot.dist) #Calculate bootstrap standard error

# Show bootstrap distribution
hist(boot.dist,  xlab = "xbar",
     main = "Bootstrap Distribution")

# Add a red line at the observed sample mean
abline(v = samp.mean, col = "red", lwd = 2, lty = 2)

# Add a blue line at the center of bootstrap dist s
abline(v = mean(boot.dist), col = "blue", lwd = 2, lty = 2)

# Compare bootstrap dist to normal dist
# Again, we'll get to these.
qqnorm(boot.dist)
qqline(boot.dist)
```

## Interval Estimates for Mean Arsenic Level

a. Compute a 95% bootstrap percentile confidence interval for the mean arsenic level in groundwater in Bangladesh.

```{r}
# Find cutoffs for 95% bootstrap CI
lower <- quantile(boot.dist, probs = 0.025)
upper <- quantile(boot.dist, probs = 0.975)
lower
upper
```

b. Interpret the practical meaning of the interval estimate.

```{r}
hist(boot.dist,  xlab = "xbar",
     main = "Bootstrap Distribution")

# Add a red line at the observed sample mean
abline(v = samp.mean, col = "red", lwd = 2, lty = 2)

# Add blue lines at the 2.5 and 97.5 percentiles
abline(v = lower, col = "blue", lwd = 2, lty = 2)
abline(v = upper, col = "blue", lwd = 2, lty = 2)
```

This interval is giving a range of plausible values for the mean arsenic level of all groundwater in Bangladesh. We are 95% confident that the interval from `r lower` ppb to `r upper` ppb contains the true mean arsenic level.


c. Sometimes it is nice to describe the interval as some value plus or minus some margin of error. Recall with normal distributions, approximately 95% of the data is within 2 standard deviations of center of the distribution.  Construct a symmetric 95% bootstrap confidence interval for the mean arsenic level.

```{r}
samp.mean - 2*sd(boot.dist) #going 2 SE's below the point est
samp.mean + 2*sd(boot.dist) #going 2 SE's below the point est
```

A 95% bootstrap confidence interval is `r samp.mean` plus or minus `r 2*sd(boot.dist)`.


## North Carolina Birth Weights Revisited

a. Give a 95\% bootstrap percentile confidence interval for the mean weight of babies born in North Carolina in 2004. 

```{r}
mean.weight <- mean(NCBirths2004$Weight)
sd.weight <- sd(NCBirths2004$Weight)
n.weight <- length(NCBirths2004$Weight)

N <- 10^5 # Number of bootstrap samples
boot.weight <- numeric(N) #create vector to store bootstrap means

for (i in 1:N)
{
  y <- sample(NCBirths2004$Weight, n.weight, replace = TRUE)
  boot.weight[i] <- mean(y)
}

# Find cutoffs for 95% bootstrap CI
lower <- quantile(boot.weight, probs = 0.025)
upper <- quantile(boot.weight, probs = 0.975)
lower
upper

hist(boot.weight,  xlab = "xbar",
     main = "Bootstrap Distribution")

# Add a red line at the observed sample mean
abline(v = mean.weight, col = "red", lwd = 2, lty = 2)

# Add blue lines at the 2.5 and 97.5 percentiles
abline(v = lower, col = "blue", lwd = 2, lty = 2)
abline(v = upper, col = "blue", lwd = 2, lty = 2)
```

Note when we compare the interval estimate above for n=1009 it is much more narrow than the 95% confidence interval we initially constructed when n=10. **As n increases, the variability decreases, the interval gets more narrow, and the estimate is more specific.**

b. Give a 90% bootstrap confidence interval to estimate the mean weight of all babies born in North Carolina in 2004.

```{r}
# Find cutoffs for 90% bootstrap CI
lower.cl90 <- quantile(boot.weight, probs = 0.05)
upper.cl90 <- quantile(boot.weight, probs = 0.95)
lower.cl90
upper.cl90
```

c. Interpret the practical meaning of your 90% bootstrap percentile confidence interval.

We are 90% confident that the interval from `r lower.cl90` grams to `r upper.cl90` grams contains the actual mean value for all births in North Carolina in 2004.


d. When we decreased the confidence level, what happened to the confidence interval estimate?

When we decrease the confidence level, our interval estimate becomes more specific (less wide). This makes sense since the more narrow our interval is, the less likely it is to contain the population parameter.

## Cable Repair Times Case Study

What is the difference between the length of commercials on basic cable channels and on extended cable channels? The table shows the total number of minutes devoted to commercials during randomly selected half-hour periods on basic and extended cable TV channels.

Basic    | 7   | 10  | 10.6 | 10.2 | 8.6 | 7.6 | 8.2 | 10.4 | 11.0 | 8.5 |     |  
---------|-----|-----|------|------|-----|-----|-----|------|------|-----|-----|-----
Extended | 3.4 | 7.8 | 9.4  | 4.7  | 5.4 | 7.6 | 5.0 | 8.0  | 7.8  | 9.6 | 6.2 | 8.1

a. Use exploratory data analysis to compare the two groups.

```{r}
times.Basic <- c(7, 10, 10.6, 10.2, 8.6, 7.6, 8.2, 10.4, 11.0, 8.5)
times.Ext <- c(3.4, 7.8, 9.4, 4.7, 5.4, 7.6, 5.0, 8.0, 7.8, 9.6, 6.2, 8.1)

# hist(times.Basic)
# hist(times.Ext)
boxplot(times.Basic, times.Ext, 
        names = c("Basic", "Extended"))

# Comparing descriptive statistics
n.Basic <- length(times.Basic)
mean(times.Basic)
sd(times.Basic)

n.Ext <- length(times.Ext)
mean(times.Ext)
sd(times.Ext)

obs.diff <- mean(times.Basic) - mean(times.Ext)
obs.diff
```

b. Generate one possible bootstrap resample (from each sample).

```{r}
sample(times.Basic, 10, replace = TRUE)
sample(times.Ext, 12, replace = TRUE)
```

c. Give a  90% bootstrap percentile confidence interval to estimate the difference between the length of commercial times.

```{r}
N <- 10^5
boot.diff.mean <- numeric(N)

for (i in 1:N)
{
  basic.samp <- sample(times.Basic, n.Basic, replace = TRUE) #resample for basic
  ext.samp <- sample(times.Ext, n.Ext, replace = TRUE) #resample for extended
  boot.diff.mean[i] <- mean(basic.samp) - mean(ext.samp)
}

# Bootstrap mean and bootstrap standard error
mean(boot.diff.mean)
sd(boot.diff.mean)

# Find cutoffs for 90% bootstrap CI
lower <- quantile(boot.diff.mean, probs = 0.05)
upper <- quantile(boot.diff.mean, probs = 0.95)
lower
upper

# Display bootstrap distribution
hist(boot.diff.mean)
abline(v = obs.diff, col = "red", lwd = 2, lty = 2)
abline(v = lower, col = "blue", lwd = 2, lty = 2)
abline(v = upper, col = "blue", lwd = 2, lty = 2)
```

d. Interpret the practical meaning of your interval estimate.

We are 90% confident that the interval from `r lower` min to `r upper` min
contains the actual value for the difference in mean commercial times of all basic cable minus the mean commercial time on all extended cable channels.

## Wetsuit Case Study

In the 2008 Olympics there was a lot of controversy over new swimsuits that possibly provided an unfair advantage to swimmers which led to new international rules regarding swimsuit materials and coverage^[*Statistics: Unlocking the Power of Statistics*. R. Lock, P. Lock, K. Lock, E. Lock, and D. Lock]. Can a swimsuit really make a swimmer faster?

A study  tested whether wearing wetsuits influences swimming velocity. Twelve competitive swimmers swam 1500 meters at maximum speed twice each. Once wearing a wetsuit and once wearing a regular bathing suit. The order of the trials was randomized. Each time, the maximum velocity in meters/sec of the swimmer was recorded.

```{r}
# Vectors containing the times of each swimmer. Ordering is critical
wetsuit <- c(1.57, 1.47, 1.42, 1.35, 1.22, 1.75, 1.64, 1.57, 1.56, 1.53, 1.49, 1.51)
none <- c(1.49, 1.37, 1.35, 1.27, 1.12, 1.64, 1.59, 1.52, 1.50, 1.45, 1.44, 1.41)
Diff <- wetsuit - none
obs.mean.diff <- mean(Diff)
```

The mean of the differences of the sample is $\bar{x}_{\rm{diff}}=$ `r print(obs.mean.diff)` meters per second.

a. Generate one possible bootstrap resample. 

```{r}
sample(Diff, 12, replace = TRUE)
```

b. Construct a 99% bootstrap percentile confidence interval to estimate this difference and interpret your answer.

```{r}
n <- length(Diff) # number of matched-pairs in sample

N <- 10^5
boot.diff <- numeric(N)

# Create bootstrap samples by picking n difference from original sample
# With replacement, and then find mean of those differences.
for (i in 1:N)
{
  samp.diff <- sample(Diff, n, replace = TRUE)
  boot.diff[i] <- mean(samp.diff)
}

# Calculate lower and upper cutoffs
# for the 95% Bootstrap CI
lower <- quantile(boot.diff, probs = 0.005)
upper <- quantile(boot.diff, probs = 0.995)
lower
upper

# Display results of bootstrap distribution
hist(boot.diff, xlab = "Difference", 
     main = "Bootstrap Distribution")
abline(v = obs.mean.diff, col = "red", lwd = 2, lty = 2)
abline(v = lower, col = "blue", lwd = 2, lty = 2)
abline(v = upper, col = "blue", lwd = 2, lty = 2)
```

d. Interpret the practical meaning of your interval estimate.

We are 99% confident that the interval from `r lower` m/sec to `r upper` m/sec
contains the actual value for the mean difference between the maximum velocities of all swimmers wearing each swimsuit.